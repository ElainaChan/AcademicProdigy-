<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Acdemic-Prodigy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Acdemic-Prodigy">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;page&#x2F;6&#x2F;index.html">
<meta property="og:site_name" content="Acdemic-Prodigy">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Acdemic-Prodigy" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Acdemic-Prodigy</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-markdown-preview-plus/lib/markdown-preview-view/index" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/10/31/markdown-preview-plus/lib/markdown-preview-view/index/" class="article-date">
  <time datetime="2019-10-31T09:19:10.840Z" itemprop="datePublished">2019-10-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/31/markdown-preview-plus/lib/markdown-preview-view/index/">markdown-preview-plus/lib/markdown-preview-view/index</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        "use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var markdown_preview_view_editor_1 = require("./markdown-preview-view-editor");
exports.MarkdownPreviewViewEditor = markdown_preview_view_editor_1.MarkdownPreviewViewEditor;
var markdown_preview_view_file_1 = require("./markdown-preview-view-file");
exports.MarkdownPreviewViewFile = markdown_preview_view_file_1.MarkdownPreviewViewFile;
var markdown_preview_view_1 = require("./markdown-preview-view");
exports.MarkdownPreviewView = markdown_preview_view_1.MarkdownPreviewView;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbWFya2Rvd24tcHJldmlldy12aWV3L2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsK0VBQTBFO0FBQWpFLG1FQUFBLHlCQUF5QixDQUFBO0FBQ2xDLDJFQUFzRTtBQUE3RCwrREFBQSx1QkFBdUIsQ0FBQTtBQUNoQyxpRUFBNEU7QUFBbkUsc0RBQUEsbUJBQW1CLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgeyBNYXJrZG93blByZXZpZXdWaWV3RWRpdG9yIH0gZnJvbSAnLi9tYXJrZG93bi1wcmV2aWV3LXZpZXctZWRpdG9yJ1xuZXhwb3J0IHsgTWFya2Rvd25QcmV2aWV3Vmlld0ZpbGUgfSBmcm9tICcuL21hcmtkb3duLXByZXZpZXctdmlldy1maWxlJ1xuZXhwb3J0IHsgTWFya2Rvd25QcmV2aWV3VmlldywgU2VyaWFsaXplZE1QViB9IGZyb20gJy4vbWFya2Rvd24tcHJldmlldy12aWV3J1xuIl19
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/10/31/markdown-preview-plus/lib/markdown-preview-view/index/" data-id="ck2kdakrf0017gsum6bdeatrl" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-markdown-preview-plus/lib/markdown-preview-view/ipc/event-handler" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/10/31/markdown-preview-plus/lib/markdown-preview-view/ipc/event-handler/" class="article-date">
  <time datetime="2019-10-31T09:19:10.840Z" itemprop="datePublished">2019-10-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/31/markdown-preview-plus/lib/markdown-preview-view/ipc/event-handler/">markdown-preview-plus/lib/markdown-preview-view/ipc/event-handler</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        "use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const electron_1 = require("electron");
class EventHandler {
    constructor(windowId, editorId, handlers) {
        this.windowId = windowId;
        this.editorId = editorId;
        this.handlers = handlers;
        this.handler = (e) => {
            if (this.editorId !== e.editorId || this.windowId !== e.windowId)
                return;
            const handler = this.handlers[e.event];
            handler(e.arg);
        };
        electron_1.remote.ipcMain.on('markdown-preview-plus:editor-event', this.handler);
    }
    dispose() {
        electron_1.remote.ipcMain.removeListener('markdown-preview-plus:editor-event', this.handler);
    }
}
exports.EventHandler = EventHandler;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXZlbnQtaGFuZGxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9tYXJrZG93bi1wcmV2aWV3LXZpZXcvaXBjL2V2ZW50LWhhbmRsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSx1Q0FBaUM7QUFzQmpDLE1BQWEsWUFBWTtJQUN2QixZQUNtQixRQUFnQixFQUNoQixRQUFnQixFQUNoQixRQUFtQztRQUZuQyxhQUFRLEdBQVIsUUFBUSxDQUFRO1FBQ2hCLGFBQVEsR0FBUixRQUFRLENBQVE7UUFDaEIsYUFBUSxHQUFSLFFBQVEsQ0FBMkI7UUFZOUMsWUFBTyxHQUFHLENBQUMsQ0FBK0IsRUFBRSxFQUFFO1lBQ3BELElBQUksSUFBSSxDQUFDLFFBQVEsS0FBSyxDQUFDLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxRQUFRLEtBQUssQ0FBQyxDQUFDLFFBQVE7Z0JBQUUsT0FBTTtZQUN4RSxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQWEsQ0FBQTtZQUNsRCxPQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBQ2hCLENBQUMsQ0FBQTtRQWRDLGlCQUFNLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxvQ0FBb0MsRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUE7SUFDdkUsQ0FBQztJQUVNLE9BQU87UUFDWixpQkFBTSxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQzNCLG9DQUFvQyxFQUNwQyxJQUFJLENBQUMsT0FBTyxDQUNiLENBQUE7SUFDSCxDQUFDO0NBT0Y7QUFyQkQsb0NBcUJDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcmVtb3RlIH0gZnJvbSAnZWxlY3Ryb24nXG5cbmV4cG9ydCBpbnRlcmZhY2UgSVBDRXZlbnRzIHtcbiAgc3luY1ByZXZpZXc6IHsgcG9zOiBudW1iZXI7IGZsYXNoOiBib29sZWFuIH1cbiAgc2Nyb2xsU3luYzogW251bWJlciwgbnVtYmVyXVxuICBkZXN0cm95OiB2b2lkXG4gIGNoYW5nZUdyYW1tYXI6IHN0cmluZ1xuICBjaGFuZ2VQYXRoOiB7IHRpdGxlOiBzdHJpbmc7IHBhdGg6IHN0cmluZyB8IHVuZGVmaW5lZCB9XG4gIGNoYW5nZVRleHQ6IHN0cmluZ1xufVxuXG5leHBvcnQgdHlwZSBJUENFdmVudEhhbmRsZXIgPSB7XG4gIFtLIGluIGtleW9mIElQQ0V2ZW50c106IChhcmc6IElQQ0V2ZW50c1tLXSkgPT4gdm9pZFxufVxuXG5leHBvcnQgdHlwZSBFZGl0b3JFdmVudDxUIGV4dGVuZHMga2V5b2YgSVBDRXZlbnRzPiA9IHtcbiAgZWRpdG9ySWQ6IG51bWJlclxuICB3aW5kb3dJZDogbnVtYmVyXG4gIGV2ZW50OiBUXG4gIGFyZzogSVBDRXZlbnRzW1RdXG59XG5cbmV4cG9ydCBjbGFzcyBFdmVudEhhbmRsZXIge1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlYWRvbmx5IHdpbmRvd0lkOiBudW1iZXIsXG4gICAgcHJpdmF0ZSByZWFkb25seSBlZGl0b3JJZDogbnVtYmVyLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgaGFuZGxlcnM6IFJlYWRvbmx5PElQQ0V2ZW50SGFuZGxlcj4sXG4gICkge1xuICAgIHJlbW90ZS5pcGNNYWluLm9uKCdtYXJrZG93bi1wcmV2aWV3LXBsdXM6ZWRpdG9yLWV2ZW50JywgdGhpcy5oYW5kbGVyKVxuICB9XG5cbiAgcHVibGljIGRpc3Bvc2UoKSB7XG4gICAgcmVtb3RlLmlwY01haW4ucmVtb3ZlTGlzdGVuZXIoXG4gICAgICAnbWFya2Rvd24tcHJldmlldy1wbHVzOmVkaXRvci1ldmVudCcsXG4gICAgICB0aGlzLmhhbmRsZXIsXG4gICAgKVxuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVyID0gKGU6IEVkaXRvckV2ZW50PGtleW9mIElQQ0V2ZW50cz4pID0+IHtcbiAgICBpZiAodGhpcy5lZGl0b3JJZCAhPT0gZS5lZGl0b3JJZCB8fCB0aGlzLndpbmRvd0lkICE9PSBlLndpbmRvd0lkKSByZXR1cm5cbiAgICBjb25zdCBoYW5kbGVyID0gdGhpcy5oYW5kbGVyc1tlLmV2ZW50XSBhcyBGdW5jdGlvblxuICAgIGhhbmRsZXIoZS5hcmcpXG4gIH1cbn1cbiJdfQ==
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/10/31/markdown-preview-plus/lib/markdown-preview-view/ipc/event-handler/" data-id="ck2kdakrr001lgsumb6afffwx" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-markdown-preview-plus/lib/markdown-preview-view/ipc/index" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/10/31/markdown-preview-plus/lib/markdown-preview-view/ipc/index/" class="article-date">
  <time datetime="2019-10-31T09:19:10.840Z" itemprop="datePublished">2019-10-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/31/markdown-preview-plus/lib/markdown-preview-view/ipc/index/">markdown-preview-plus/lib/markdown-preview-view/ipc/index</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        "use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var ipc_caller_1 = require("./ipc-caller");
exports.IPCCaller = ipc_caller_1.IPCCaller;
var event_handler_1 = require("./event-handler");
exports.EventHandler = event_handler_1.EventHandler;
var request_handler_1 = require("./request-handler");
exports.RequestHandler = request_handler_1.RequestHandler;
var setup_editor_1 = require("./setup-editor");
exports.RemoteEditorServer = setup_editor_1.RemoteEditorServer;
var should_scroll_sync_1 = require("./should-scroll-sync");
exports.shouldScrollSync = should_scroll_sync_1.shouldScrollSync;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbWFya2Rvd24tcHJldmlldy12aWV3L2lwYy9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLDJDQUF3QztBQUEvQixpQ0FBQSxTQUFTLENBQUE7QUFDbEIsaURBQThDO0FBQXJDLHVDQUFBLFlBQVksQ0FBQTtBQUNyQixxREFBa0Q7QUFBekMsMkNBQUEsY0FBYyxDQUFBO0FBQ3ZCLCtDQUFtRDtBQUExQyw0Q0FBQSxrQkFBa0IsQ0FBQTtBQUMzQiwyREFBdUQ7QUFBOUMsZ0RBQUEsZ0JBQWdCLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgeyBJUENDYWxsZXIgfSBmcm9tICcuL2lwYy1jYWxsZXInXG5leHBvcnQgeyBFdmVudEhhbmRsZXIgfSBmcm9tICcuL2V2ZW50LWhhbmRsZXInXG5leHBvcnQgeyBSZXF1ZXN0SGFuZGxlciB9IGZyb20gJy4vcmVxdWVzdC1oYW5kbGVyJ1xuZXhwb3J0IHsgUmVtb3RlRWRpdG9yU2VydmVyIH0gZnJvbSAnLi9zZXR1cC1lZGl0b3InXG5leHBvcnQgeyBzaG91bGRTY3JvbGxTeW5jIH0gZnJvbSAnLi9zaG91bGQtc2Nyb2xsLXN5bmMnXG4iXX0=
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/10/31/markdown-preview-plus/lib/markdown-preview-view/ipc/index/" data-id="ck2kdakrt001ogsumbnjb970o" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-markdown-preview-plus/lib/markdown-it-math/lib/table" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/10/31/markdown-preview-plus/lib/markdown-it-math/lib/table/" class="article-date">
  <time datetime="2019-10-31T09:19:10.839Z" itemprop="datePublished">2019-10-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/31/markdown-preview-plus/lib/markdown-it-math/lib/table/">markdown-preview-plus/lib/markdown-it-math/lib/table</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        "use strict";
Object.defineProperty(exports, "__esModule", { value: true });
function getLine(state, line) {
    const pos = state.bMarks[line] + state.blkIndent;
    const max = state.eMarks[line];
    return state.src.substr(pos, max - pos);
}
function escapedSplit(str, openDelims, closeDelims) {
    const result = [];
    let pos = 0;
    const max = str.length;
    let ch;
    let escapes = 0;
    let lastPos = 0;
    let lastDelim = 0;
    let delimed = false;
    let delimMaskMap;
    let openDelimIdx = -1;
    let closeDelimIdx = -1;
    ch = str.charCodeAt(pos);
    delimMaskMap = function (e) {
        return str.substring(pos, pos + e.length) === e;
    };
    while (pos < max) {
        openDelimIdx = openDelims.map(delimMaskMap).indexOf(true);
        closeDelimIdx = closeDelims.map(delimMaskMap).indexOf(true);
        if (openDelimIdx > -1 && escapes % 2 === 0 && !delimed) {
            delimed = !delimed;
            lastDelim = pos + openDelims[openDelimIdx].length - 1;
            pos += openDelims[openDelimIdx].length - 1;
        }
        else if (closeDelimIdx > -1 && escapes % 2 === 0 && delimed) {
            delimed = !delimed;
            lastDelim = pos + closeDelims[closeDelimIdx].length - 1;
            pos += closeDelims[closeDelimIdx].length - 1;
        }
        else if (ch === 0x7c && escapes % 2 === 0 && !delimed) {
            result.push(str.substring(lastPos, pos));
            lastPos = pos + 1;
        }
        else if (ch === 0x5c) {
            escapes++;
        }
        else {
            escapes = 0;
        }
        pos++;
        if (pos === max && delimed) {
            delimed = false;
            pos = lastDelim + 1;
        }
        ch = str.charCodeAt(pos);
    }
    result.push(str.substring(lastPos));
    return result;
}
function table(openDelims, closeDelims, state, startLine, endLine, silent) {
    let ch;
    let lineText;
    let pos;
    let i;
    let nextLine;
    let columns;
    let columnCount;
    let token;
    let aligns;
    let t;
    let tableLines;
    let tbodyLines;
    if (startLine + 2 > endLine) {
        return false;
    }
    nextLine = startLine + 1;
    if (state.sCount[nextLine] < state.blkIndent) {
        return false;
    }
    pos = state.bMarks[nextLine] + state.tShift[nextLine];
    if (pos >= state.eMarks[nextLine]) {
        return false;
    }
    ch = state.src.charCodeAt(pos);
    if (ch !== 0x7c && ch !== 0x2d && ch !== 0x3a) {
        return false;
    }
    lineText = getLine(state, startLine + 1);
    if (!/^[-:| ]+$/.test(lineText)) {
        return false;
    }
    columns = lineText.split('|');
    aligns = [];
    for (i = 0; i < columns.length; i++) {
        t = columns[i].trim();
        if (!t) {
            if (i === 0 || i === columns.length - 1) {
                continue;
            }
            else {
                return false;
            }
        }
        if (!/^:?-+:?$/.test(t)) {
            return false;
        }
        if (t.charCodeAt(t.length - 1) === 0x3a) {
            aligns.push(t.charCodeAt(0) === 0x3a ? 'center' : 'right');
        }
        else if (t.charCodeAt(0) === 0x3a) {
            aligns.push('left');
        }
        else {
            aligns.push('');
        }
    }
    lineText = getLine(state, startLine).trim();
    if (lineText.indexOf('|') === -1) {
        return false;
    }
    columns = escapedSplit(lineText.replace(/^\||\|$/g, ''), openDelims, closeDelims);
    columnCount = columns.length;
    if (columnCount > aligns.length) {
        return false;
    }
    if (silent) {
        return true;
    }
    token = state.push('table_open', 'table', 1);
    token.map = tableLines = [startLine, 0];
    token = state.push('thead_open', 'thead', 1);
    token.map = [startLine, startLine + 1];
    token = state.push('tr_open', 'tr', 1);
    token.map = [startLine, startLine + 1];
    for (i = 0; i < columns.length; i++) {
        token = state.push('th_open', 'th', 1);
        token.map = [startLine, startLine + 1];
        if (aligns[i]) {
            token.attrs = [['style', 'text-align:' + aligns[i]]];
        }
        token = state.push('inline', '', 0);
        token.content = columns[i].trim();
        token.map = [startLine, startLine + 1];
        token.children = [];
        token = state.push('th_close', 'th', -1);
    }
    token = state.push('tr_close', 'tr', -1);
    token = state.push('thead_close', 'thead', -1);
    token = state.push('tbody_open', 'tbody', 1);
    token.map = tbodyLines = [startLine + 2, 0];
    for (nextLine = startLine + 2; nextLine < endLine; nextLine++) {
        if (state.sCount[nextLine] < state.blkIndent) {
            break;
        }
        lineText = getLine(state, nextLine).trim();
        if (lineText.indexOf('|') === -1) {
            break;
        }
        columns = escapedSplit(lineText.replace(/^\||\|$/g, ''), openDelims, closeDelims);
        token = state.push('tr_open', 'tr', 1);
        for (i = 0; i < columnCount; i++) {
            token = state.push('td_open', 'td', 1);
            if (aligns[i]) {
                token.attrs = [['style', 'text-align:' + aligns[i]]];
            }
            token = state.push('inline', '', 0);
            token.content = columns[i] ? columns[i].trim() : '';
            token.children = [];
            token = state.push('td_close', 'td', -1);
        }
        token = state.push('tr_close', 'tr', -1);
    }
    token = state.push('tbody_close', 'tbody', -1);
    token = state.push('table_close', 'table', -1);
    tableLines[1] = tbodyLines[1] = nextLine;
    state.line = nextLine;
    return true;
}
function makeTable(options) {
    const openDelims = options.inlineDelim.map((i) => i[0]);
    const closeDelims = options.inlineDelim.map((i) => i[1]);
    openDelims.unshift('`');
    closeDelims.unshift('`');
    return table.bind(null, openDelims, closeDelims);
}
exports.makeTable = makeTable;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFibGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbWFya2Rvd24taXQtbWF0aC9saWIvdGFibGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFJQSxTQUFTLE9BQU8sQ0FBQyxLQUFVLEVBQUUsSUFBWTtJQUN2QyxNQUFNLEdBQUcsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQyxTQUFTLENBQUE7SUFDaEQsTUFBTSxHQUFHLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUU5QixPQUFPLEtBQUssQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUE7QUFDekMsQ0FBQztBQWtCRCxTQUFTLFlBQVksQ0FDbkIsR0FBVyxFQUNYLFVBQW9CLEVBQ3BCLFdBQXFCO0lBRXJCLE1BQU0sTUFBTSxHQUFHLEVBQUUsQ0FBQTtJQUNqQixJQUFJLEdBQUcsR0FBRyxDQUFDLENBQUE7SUFDWCxNQUFNLEdBQUcsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFBO0lBQ3RCLElBQUksRUFBRSxDQUFBO0lBQ04sSUFBSSxPQUFPLEdBQUcsQ0FBQyxDQUFBO0lBQ2YsSUFBSSxPQUFPLEdBQUcsQ0FBQyxDQUFBO0lBQ2YsSUFBSSxTQUFTLEdBQUcsQ0FBQyxDQUFBO0lBQ2pCLElBQUksT0FBTyxHQUFHLEtBQUssQ0FBQTtJQUNuQixJQUFJLFlBQVksQ0FBQTtJQUNoQixJQUFJLFlBQVksR0FBRyxDQUFDLENBQUMsQ0FBQTtJQUNyQixJQUFJLGFBQWEsR0FBRyxDQUFDLENBQUMsQ0FBQTtJQUV0QixFQUFFLEdBQUcsR0FBRyxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQTtJQUd4QixZQUFZLEdBQUcsVUFBUyxDQUFTO1FBQy9CLE9BQU8sR0FBRyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUE7SUFDakQsQ0FBQyxDQUFBO0lBRUQsT0FBTyxHQUFHLEdBQUcsR0FBRyxFQUFFO1FBRWhCLFlBQVksR0FBRyxVQUFVLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQTtRQUN6RCxhQUFhLEdBQUcsV0FBVyxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUE7UUFHM0QsSUFBSSxZQUFZLEdBQUcsQ0FBQyxDQUFDLElBQUksT0FBTyxHQUFHLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDdEQsT0FBTyxHQUFHLENBQUMsT0FBTyxDQUFBO1lBQ2xCLFNBQVMsR0FBRyxHQUFHLEdBQUcsVUFBVSxDQUFDLFlBQVksQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUE7WUFDckQsR0FBRyxJQUFJLFVBQVUsQ0FBQyxZQUFZLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFBO1NBRTNDO2FBQU0sSUFBSSxhQUFhLEdBQUcsQ0FBQyxDQUFDLElBQUksT0FBTyxHQUFHLENBQUMsS0FBSyxDQUFDLElBQUksT0FBTyxFQUFFO1lBQzdELE9BQU8sR0FBRyxDQUFDLE9BQU8sQ0FBQTtZQUNsQixTQUFTLEdBQUcsR0FBRyxHQUFHLFdBQVcsQ0FBQyxhQUFhLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFBO1lBQ3ZELEdBQUcsSUFBSSxXQUFXLENBQUMsYUFBYSxDQUFDLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQTtTQUM3QzthQUFNLElBQUksRUFBRSxLQUFLLElBQUksSUFBWSxPQUFPLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUMvRCxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUE7WUFDeEMsT0FBTyxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUE7U0FDbEI7YUFBTSxJQUFJLEVBQUUsS0FBSyxJQUFJLEVBQVU7WUFDOUIsT0FBTyxFQUFFLENBQUE7U0FDVjthQUFNO1lBQ0wsT0FBTyxHQUFHLENBQUMsQ0FBQTtTQUNaO1FBRUQsR0FBRyxFQUFFLENBQUE7UUFJTCxJQUFJLEdBQUcsS0FBSyxHQUFHLElBQUksT0FBTyxFQUFFO1lBQzFCLE9BQU8sR0FBRyxLQUFLLENBQUE7WUFDZixHQUFHLEdBQUcsU0FBUyxHQUFHLENBQUMsQ0FBQTtTQUNwQjtRQUVELEVBQUUsR0FBRyxHQUFHLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFBO0tBQ3pCO0lBRUQsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUE7SUFFbkMsT0FBTyxNQUFNLENBQUE7QUFDZixDQUFDO0FBZUQsU0FBUyxLQUFLLENBQ1osVUFBb0IsRUFDcEIsV0FBcUIsRUFDckIsS0FBVSxFQUNWLFNBQWlCLEVBQ2pCLE9BQWUsRUFDZixNQUFlO0lBRWYsSUFBSSxFQUFFLENBQUE7SUFDTixJQUFJLFFBQVEsQ0FBQTtJQUNaLElBQUksR0FBRyxDQUFBO0lBQ1AsSUFBSSxDQUFDLENBQUE7SUFDTCxJQUFJLFFBQVEsQ0FBQTtJQUNaLElBQUksT0FBTyxDQUFBO0lBQ1gsSUFBSSxXQUFXLENBQUE7SUFDZixJQUFJLEtBQUssQ0FBQTtJQUNULElBQUksTUFBTSxDQUFBO0lBQ1YsSUFBSSxDQUFDLENBQUE7SUFDTCxJQUFJLFVBQVUsQ0FBQTtJQUNkLElBQUksVUFBVSxDQUFBO0lBR2QsSUFBSSxTQUFTLEdBQUcsQ0FBQyxHQUFHLE9BQU8sRUFBRTtRQUMzQixPQUFPLEtBQUssQ0FBQTtLQUNiO0lBRUQsUUFBUSxHQUFHLFNBQVMsR0FBRyxDQUFDLENBQUE7SUFFeEIsSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxHQUFHLEtBQUssQ0FBQyxTQUFTLEVBQUU7UUFDNUMsT0FBTyxLQUFLLENBQUE7S0FDYjtJQUlELEdBQUcsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUE7SUFDckQsSUFBSSxHQUFHLElBQUksS0FBSyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsRUFBRTtRQUNqQyxPQUFPLEtBQUssQ0FBQTtLQUNiO0lBRUQsRUFBRSxHQUFHLEtBQUssQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFBO0lBQzlCLElBQUksRUFBRSxLQUFLLElBQUksSUFBWSxFQUFFLEtBQUssSUFBSSxJQUFZLEVBQUUsS0FBSyxJQUFJLEVBQVU7UUFDckUsT0FBTyxLQUFLLENBQUE7S0FDYjtJQUVELFFBQVEsR0FBRyxPQUFPLENBQUMsS0FBSyxFQUFFLFNBQVMsR0FBRyxDQUFDLENBQUMsQ0FBQTtJQUN4QyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRTtRQUMvQixPQUFPLEtBQUssQ0FBQTtLQUNiO0lBRUQsT0FBTyxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUE7SUFDN0IsTUFBTSxHQUFHLEVBQUUsQ0FBQTtJQUNYLEtBQUssQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtRQUNuQyxDQUFDLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFBO1FBQ3JCLElBQUksQ0FBQyxDQUFDLEVBQUU7WUFHTixJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO2dCQUN2QyxTQUFRO2FBQ1Q7aUJBQU07Z0JBQ0wsT0FBTyxLQUFLLENBQUE7YUFDYjtTQUNGO1FBRUQsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUU7WUFDdkIsT0FBTyxLQUFLLENBQUE7U0FDYjtRQUNELElBQUksQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxLQUFLLElBQUksRUFBVTtZQUMvQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFTLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFBO1NBQ25FO2FBQU0sSUFBSSxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksRUFBVTtZQUMzQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFBO1NBQ3BCO2FBQU07WUFDTCxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFBO1NBQ2hCO0tBQ0Y7SUFFRCxRQUFRLEdBQUcsT0FBTyxDQUFDLEtBQUssRUFBRSxTQUFTLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQTtJQUMzQyxJQUFJLFFBQVEsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUU7UUFDaEMsT0FBTyxLQUFLLENBQUE7S0FDYjtJQUNELE9BQU8sR0FBRyxZQUFZLENBQ3BCLFFBQVEsQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLEVBQUUsQ0FBQyxFQUNoQyxVQUFVLEVBQ1YsV0FBVyxDQUNaLENBQUE7SUFJRCxXQUFXLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQTtJQUM1QixJQUFJLFdBQVcsR0FBRyxNQUFNLENBQUMsTUFBTSxFQUFFO1FBQy9CLE9BQU8sS0FBSyxDQUFBO0tBQ2I7SUFFRCxJQUFJLE1BQU0sRUFBRTtRQUNWLE9BQU8sSUFBSSxDQUFBO0tBQ1o7SUFFRCxLQUFLLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFBO0lBQzVDLEtBQUssQ0FBQyxHQUFHLEdBQUcsVUFBVSxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFBO0lBRXZDLEtBQUssR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUE7SUFDNUMsS0FBSyxDQUFDLEdBQUcsR0FBRyxDQUFDLFNBQVMsRUFBRSxTQUFTLEdBQUcsQ0FBQyxDQUFDLENBQUE7SUFFdEMsS0FBSyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQTtJQUN0QyxLQUFLLENBQUMsR0FBRyxHQUFHLENBQUMsU0FBUyxFQUFFLFNBQVMsR0FBRyxDQUFDLENBQUMsQ0FBQTtJQUV0QyxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7UUFDbkMsS0FBSyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQTtRQUN0QyxLQUFLLENBQUMsR0FBRyxHQUFHLENBQUMsU0FBUyxFQUFFLFNBQVMsR0FBRyxDQUFDLENBQUMsQ0FBQTtRQUN0QyxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUNiLEtBQUssQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLE9BQU8sRUFBRSxhQUFhLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtTQUNyRDtRQUVELEtBQUssR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUE7UUFDbkMsS0FBSyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUE7UUFDakMsS0FBSyxDQUFDLEdBQUcsR0FBRyxDQUFDLFNBQVMsRUFBRSxTQUFTLEdBQUcsQ0FBQyxDQUFDLENBQUE7UUFDdEMsS0FBSyxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUE7UUFFbkIsS0FBSyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLElBQUksRUFBRSxDQUFD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R0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtJQUN2RCxNQUFNLFdBQVcsR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7SUFFeEQsVUFBVSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQTtJQUN2QixXQUFXLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFBO0lBRXhCLE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsVUFBVSxFQUFFLFdBQVcsQ0FBQyxDQUFBO0FBQ2xELENBQUM7QUFSRCw4QkFRQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIG1hcmtkb3duLWl0LW1hdGhANDgwMjQzOTpsaWIvcnVsZXNfYmxvY2svdGFibGUuanNcbi8vIEdGTSB0YWJsZSwgbm9uLXN0YW5kYXJkXG4vLyB0c2xpbnQ6ZGlzYWJsZTpuby11bnNhZmUtYW55XG5cbmZ1bmN0aW9uIGdldExpbmUoc3RhdGU6IGFueSwgbGluZTogbnVtYmVyKSB7XG4gIGNvbnN0IHBvcyA9IHN0YXRlLmJNYXJrc1tsaW5lXSArIHN0YXRlLmJsa0luZGVudFxuICBjb25zdCBtYXggPSBzdGF0ZS5lTWFya3NbbGluZV1cblxuICByZXR1cm4gc3RhdGUuc3JjLnN1YnN0cihwb3MsIG1heCAtIHBvcylcbn1cblxuLyoqXG4gKiBQYXJzZSBhIHRhYmxlIHJvdyBmb3IgY29sdW1ucy9jZWxsc1xuICpcbiAqIEBwYXJhbSBzdHJpbmcgc3RyXG4gKiAgIFRoZSB0YWJsZSByb3cgdG8gcGFyc2UgZm9yIGNvbHVtbnMuXG4gKiBAcGFyYW0gIGFycmF5IG9mIHN0cmluZyBvcGVuRGVsaW1zXG4gKiAgIFRoZSBvcGVuaW5nIGRlbGltaXRlciBzZXF1ZW5jZXMgZm9yIGlubGluZXMgdGhhdCBwcmV2ZW50cyBhbnkgY29udGFpbmVkXG4gKiAgIHBpcGVzIGZyb20gZGVsaW1pdGluZyBjb2x1bW5zIG9mIHRoZSBwYXJlbnQgdGFibGUgYmxvY2suXG4gKiBAcGFyYW0gIGFycmF5IG9mIHN0cmluZyBjbG9zZURlbGltc1xuICogICBUaGUgY2xvc2luZyBkZWxpbWl0ZXIgc2VxdWVuY2UgZm9yIGFuIGlubGluZSB0aGF0IHByZXZlbnRzIGFueSBjb250YWluaW5nXG4gKiAgIHBpcGVzIGZyb20gZGVsaW1pdGluZyBjb2x1bW5zIG9mIHRoZSBwYXJlbnQgdGFibGUgYmxvY2suXG4gKiBAcmV0dXJuIGFycmF5IG9mIHN0cmluZ1xuICogICBUaGUgdW5wYXJzZWQgY29udGVudCBvZiB0aGUgY2VsbHMvY29sdW1ucyBpZGVudGlmaWVkIGluIHN0ciByZXR1cm5lZCBhc1xuICogICBpbmRpdmlkdWFsIGVsZW1lbnRzIG9mIGFuIGFycmF5LiBUaGUgY29udGVudCBpcyBzdGlsbCB0byBiZSBwYXJzZWQgYnkgdGhlXG4gKiAgIGlubGluZSBydWxlcy5cbiAqL1xuZnVuY3Rpb24gZXNjYXBlZFNwbGl0KFxuICBzdHI6IHN0cmluZyxcbiAgb3BlbkRlbGltczogc3RyaW5nW10sXG4gIGNsb3NlRGVsaW1zOiBzdHJpbmdbXSxcbikge1xuICBjb25zdCByZXN1bHQgPSBbXVxuICBsZXQgcG9zID0gMFxuICBjb25zdCBtYXggPSBzdHIubGVuZ3RoXG4gIGxldCBjaFxuICBsZXQgZXNjYXBlcyA9IDBcbiAgbGV0IGxhc3RQb3MgPSAwXG4gIGxldCBsYXN0RGVsaW0gPSAwXG4gIGxldCBkZWxpbWVkID0gZmFsc2VcbiAgbGV0IGRlbGltTWFza01hcFxuICBsZXQgb3BlbkRlbGltSWR4ID0gLTFcbiAgbGV0IGNsb3NlRGVsaW1JZHggPSAtMVxuXG4gIGNoID0gc3RyLmNoYXJDb2RlQXQocG9zKVxuXG4gIC8vIERlZiBtYXAgZm9yIG1hdGNoaW5nIG9wZW4vY2xvc2UgZGVsaW1pdGVyIHNlcXVlbmNlIHdpdGggc3RyQHBvc1xuICBkZWxpbU1hc2tNYXAgPSBmdW5jdGlvbihlOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gc3RyLnN1YnN0cmluZyhwb3MsIHBvcyArIGUubGVuZ3RoKSA9PT0gZVxuICB9XG5cbiAgd2hpbGUgKHBvcyA8IG1heCkge1xuICAgIC8vIERldGVybWluZSBJRCBvZiBmaXJzdCBtYXRjaGluZyBvcGVuL2Nsb3NlIGRlbGltaXRlciBzZXF1ZW5jZVxuICAgIG9wZW5EZWxpbUlkeCA9IG9wZW5EZWxpbXMubWFwKGRlbGltTWFza01hcCkuaW5kZXhPZih0cnVlKVxuICAgIGNsb3NlRGVsaW1JZHggPSBjbG9zZURlbGltcy5tYXAoZGVsaW1NYXNrTWFwKS5pbmRleE9mKHRydWUpXG5cbiAgICAvLyBEb2VzIHN0ckBwb3MgbWF0Y2ggYW55IG9wZW5pbmcgZGVsaW1pdGVyP1xuICAgIGlmIChvcGVuRGVsaW1JZHggPiAtMSAmJiBlc2NhcGVzICUgMiA9PT0gMCAmJiAhZGVsaW1lZCkge1xuICAgICAgZGVsaW1lZCA9ICFkZWxpbWVkXG4gICAgICBsYXN0RGVsaW0gPSBwb3MgKyBvcGVuRGVsaW1zW29wZW5EZWxpbUlkeF0ubGVuZ3RoIC0gMVxuICAgICAgcG9zICs9IG9wZW5EZWxpbXNbb3BlbkRlbGltSWR4XS5sZW5ndGggLSAxXG4gICAgICAvLyBEb2VzIHN0ckBwb3MgbWF0Y2ggYW55IGNsb3NpbmcgZGVsaW1pdGVyP1xuICAgIH0gZWxzZSBpZiAoY2xvc2VEZWxpbUlkeCA+IC0xICYmIGVzY2FwZXMgJSAyID09PSAwICYmIGRlbGltZWQpIHtcbiAgICAgIGRlbGltZWQgPSAhZGVsaW1lZFxuICAgICAgbGFzdERlbGltID0gcG9zICsgY2xvc2VEZWxpbXNbY2xvc2VEZWxpbUlkeF0ubGVuZ3RoIC0gMVxuICAgICAgcG9zICs9IGNsb3NlRGVsaW1zW2Nsb3NlRGVsaW1JZHhdLmxlbmd0aCAtIDFcbiAgICB9IGVsc2UgaWYgKGNoID09PSAweDdjIC8qIHwgKi8gJiYgZXNjYXBlcyAlIDIgPT09IDAgJiYgIWRlbGltZWQpIHtcbiAgICAgIHJlc3VsdC5wdXNoKHN0ci5zdWJzdHJpbmcobGFzdFBvcywgcG9zKSlcbiAgICAgIGxhc3RQb3MgPSBwb3MgKyAxXG4gICAgfSBlbHNlIGlmIChjaCA9PT0gMHg1YyAvKiBcXCAqLykge1xuICAgICAgZXNjYXBlcysrXG4gICAgfSBlbHNlIHtcbiAgICAgIGVzY2FwZXMgPSAwXG4gICAgfVxuXG4gICAgcG9zKytcblxuICAgIC8vIElmIHRoZXJlIHdhcyBhbiB1bi1jbG9zZWQgZGVsaW1pdGVyIHNlcXVlbmNlLCBnbyBiYWNrIHRvIGp1c3QgYWZ0ZXJcbiAgICAvLyB0aGUgbGFzdCBkZWxpbWl0ZXIgc2VxdWVuY2UsIGJ1dCBhcyBpZiBpdCB3YXMgYSBub3JtYWwgY2hhcmFjdGVyXG4gICAgaWYgKHBvcyA9PT0gbWF4ICYmIGRlbGltZWQpIHtcbiAgICAgIGRlbGltZWQgPSBmYWxzZVxuICAgICAgcG9zID0gbGFzdERlbGltICsgMVxuICAgIH1cblxuICAgIGNoID0gc3RyLmNoYXJDb2RlQXQocG9zKVxuICB9XG5cbiAgcmVzdWx0LnB1c2goc3RyLnN1YnN0cmluZyhsYXN0UG9zKSlcblxuICByZXR1cm4gcmVzdWx0XG59XG5cbi8qKlxuICogQSB0YWJsZSBwbG9jayBwYXJzZXIgd2l0aCByZXN0cmljdGlvbnMgb24gcGlwZSBwbGFjZW1lbnRcbiAqXG4gKiBQYXJ0aWFsbHkgcG91bGF0ZWQgZG9jc3RyaW5nIGRlc2NyaWJpbmcgcGFyYW1ldGVycyBhZGRlZCB0b1xuICogYG1hcmtkb3duLWl0LW1hdGhANDgwMjQzOTpsaWIvcnVsZXNfYmxvY2svdGFibGUuanNgLlxuICpcbiAqIEBwYXJhbSAgYXJyYXkgb2Ygc3RyaW5nIG9wZW5EZWxpbXNcbiAqICAgVGhlIG9wZW5pbmcgZGVsaW1pdGVyIHNlcXVlbmNlcyBmb3IgaW5saW5lcyB0aGF0IHByZXZlbnRzIGFueSBjb250YWluZWRcbiAqICAgcGlwZXMgZnJvbSBkZWxpbWl0aW5nIGNvbHVtbnMgb2YgdGhlIHBhcmVudCB0YWJsZSBibG9jay5cbiAqIEBwYXJhbSAgYXJyYXkgb2Ygc3RyaW5nIGNsb3NlRGVsaW1zXG4gKiAgIFRoZSBjbG9zaW5nIGRlbGltaXRlciBzZXF1ZW5jZSBmb3IgYW4gaW5saW5lIHRoYXQgcHJldmVudHMgYW55IGNvbnRhaW5pbmdcbiAqICAgcGlwZXMgZnJvbSBkZWxpbWl0aW5nIGNvbHVtbnMgb2YgdGhlIHBhcmVudCB0YWJsZSBibG9jay5cbiAqL1xuZnVuY3Rpb24gdGFibGUoXG4gIG9wZW5EZWxpbXM6IHN0cmluZ1tdLFxuICBjbG9zZURlbGltczogc3RyaW5nW10sXG4gIHN0YXRlOiBhbnksXG4gIHN0YXJ0TGluZTogbnVtYmVyLFxuICBlbmRMaW5lOiBudW1iZXIsXG4gIHNpbGVudDogYm9vbGVhbixcbikge1xuICBsZXQgY2hcbiAgbGV0IGxpbmVUZXh0XG4gIGxldCBwb3NcbiAgbGV0IGlcbiAgbGV0IG5leHRMaW5lXG4gIGxldCBjb2x1bW5zXG4gIGxldCBjb2x1bW5Db3VudFxuICBsZXQgdG9rZW5cbiAgbGV0IGFsaWduc1xuICBsZXQgdFxuICBsZXQgdGFibGVMaW5lc1xuICBsZXQgdGJvZHlMaW5lc1xuXG4gIC8vIHNob3VsZCBoYXZlIGF0IGxlYXN0IHRocmVlIGxpbmVzXG4gIGlmIChzdGFydExpbmUgKyAyID4gZW5kTGluZSkge1xuICAgIHJldHVybiBmYWxzZVxuICB9XG5cbiAgbmV4dExpbmUgPSBzdGFydExpbmUgKyAxXG5cbiAgaWYgKHN0YXRlLnNDb3VudFtuZXh0TGluZV0gPCBzdGF0ZS5ibGtJbmRlbnQpIHtcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxuXG4gIC8vIGZpcnN0IGNoYXJhY3RlciBvZiB0aGUgc2Vjb25kIGxpbmUgc2hvdWxkIGJlICd8JyBvciAnLSdcblxuICBwb3MgPSBzdGF0ZS5iTWFya3NbbmV4dExpbmVdICsgc3RhdGUudFNoaWZ0W25leHRMaW5lXVxuICBpZiAocG9zID49IHN0YXRlLmVNYXJrc1tuZXh0TGluZV0pIHtcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxuXG4gIGNoID0gc3RhdGUuc3JjLmNoYXJDb2RlQXQocG9zKVxuICBpZiAoY2ggIT09IDB4N2MgLyogfCAqLyAmJiBjaCAhPT0gMHgyZCAvKiAtICovICYmIGNoICE9PSAweDNhIC8qIDogKi8pIHtcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxuXG4gIGxpbmVUZXh0ID0gZ2V0TGluZShzdGF0ZSwgc3RhcnRMaW5lICsgMSlcbiAgaWYgKCEvXlstOnwgXSskLy50ZXN0KGxpbmVUZXh0KSkge1xuICAgIHJldHVybiBmYWxzZVxuICB9XG5cbiAgY29sdW1ucyA9IGxpbmVUZXh0LnNwbGl0KCd8JylcbiAgYWxpZ25zID0gW11cbiAgZm9yIChpID0gMDsgaSA8IGNvbHVtbnMubGVuZ3RoOyBpKyspIHtcbiAgICB0ID0gY29sdW1uc1tpXS50cmltKClcbiAgICBpZiAoIXQpIHtcbiAgICAgIC8vIGFsbG93IGVtcHR5IGNvbHVtbnMgYmVmb3JlIGFuZCBhZnRlciB0YWJsZSwgYnV0IG5vdCBpbiBiZXR3ZWVuIGNvbHVtbnM7XG4gICAgICAvLyBlLmcuIGFsbG93IGAgfC0tLXwgYCwgZGlzYWxsb3cgYCAtLS18fC0tLSBgXG4gICAgICBpZiAoaSA9PT0gMCB8fCBpID09PSBjb2x1bW5zLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgY29udGludWVcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmICghL146Py0rOj8kLy50ZXN0KHQpKSB7XG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG4gICAgaWYgKHQuY2hhckNvZGVBdCh0Lmxlbmd0aCAtIDEpID09PSAweDNhIC8qIDogKi8pIHtcbiAgICAgIGFsaWducy5wdXNoKHQuY2hhckNvZGVBdCgwKSA9PT0gMHgzYSAvKiA6ICovID8gJ2NlbnRlcicgOiAncmlnaHQnKVxuICAgIH0gZWxzZSBpZiAodC5jaGFyQ29kZUF0KDApID09PSAweDNhIC8qIDogKi8pIHtcbiAgICAgIGFsaWducy5wdXNoKCdsZWZ0JylcbiAgICB9IGVsc2Uge1xuICAgICAgYWxpZ25zLnB1c2goJycpXG4gICAgfVxuICB9XG5cbiAgbGluZVRleHQgPSBnZXRMaW5lKHN0YXRlLCBzdGFydExpbmUpLnRyaW0oKVxuICBpZiAobGluZVRleHQuaW5kZXhPZignfCcpID09PSAtMSkge1xuICAgIHJldHVybiBmYWxzZVxuICB9XG4gIGNvbHVtbnMgPSBlc2NhcGVkU3BsaXQoXG4gICAgbGluZVRleHQucmVwbGFjZSgvXlxcfHxcXHwkL2csICcnKSxcbiAgICBvcGVuRGVsaW1zLFxuICAgIGNsb3NlRGVsaW1zLFxuICApXG5cbiAgLy8gaGVhZGVyIHJvdyB3aWxsIGRlZmluZSBhbiBhbW91bnQgb2YgY29sdW1ucyBpbiB0aGUgZW50aXJlIHRhYmxlLFxuICAvLyBhbmQgYWxpZ24gcm93IHNob3VsZG4ndCBiZSBzbWFsbGVyIHRoYW4gdGhhdCAodGhlIHJlc3Qgb2YgdGhlIHJvd3MgY2FuKVxuICBjb2x1bW5Db3VudCA9IGNvbHVtbnMubGVuZ3RoXG4gIGlmIChjb2x1bW5Db3VudCA+IGFsaWducy5sZW5ndGgpIHtcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxuXG4gIGlmIChzaWxlbnQpIHtcbiAgICByZXR1cm4gdHJ1ZVxuICB9XG5cbiAgdG9rZW4gPSBzdGF0ZS5wdXNoKCd0YWJsZV9vcGVuJywgJ3RhYmxlJywgMSlcbiAgdG9rZW4ubWFwID0gdGFibGVMaW5lcyA9IFtzdGFydExpbmUsIDBdXG5cbiAgdG9rZW4gPSBzdGF0ZS5wdXNoKCd0aGVhZF9vcGVuJywgJ3RoZWFkJywgMSlcbiAgdG9rZW4ubWFwID0gW3N0YXJ0TGluZSwgc3RhcnRMaW5lICsgMV1cblxuICB0b2tlbiA9IHN0YXRlLnB1c2goJ3RyX29wZW4nLCAndHInLCAxKVxuICB0b2tlbi5tYXAgPSBbc3RhcnRMaW5lLCBzdGFydExpbmUgKyAxXVxuXG4gIGZvciAoaSA9IDA7IGkgPCBjb2x1bW5zLmxlbmd0aDsgaSsrKSB7XG4gICAgdG9rZW4gPSBzdGF0ZS5wdXNoKCd0aF9vcGVuJywgJ3RoJywgMSlcbiAgICB0b2tlbi5tYXAgPSBbc3RhcnRMaW5lLCBzdGFydExpbmUgKyAxXVxuICAgIGlmIChhbGlnbnNbaV0pIHtcbiAgICAgIHRva2VuLmF0dHJzID0gW1snc3R5bGUnLCAndGV4dC1hbGlnbjonICsgYWxpZ25zW2ldXV1cbiAgICB9XG5cbiAgICB0b2tlbiA9IHN0YXRlLnB1c2goJ2lubGluZScsICcnLCAwKVxuICAgIHRva2VuLmNvbnRlbnQgPSBjb2x1bW5zW2ldLnRyaW0oKVxuICAgIHRva2VuLm1hcCA9IFtzdGFydExpbmUsIHN0YXJ0TGluZSArIDFdXG4gICAgdG9rZW4uY2hpbGRyZW4gPSBbXVxuXG4gICAgdG9rZW4gPSBzdGF0ZS5wdXNoKCd0aF9jbG9zZScsICd0aCcsIC0xKVxuICB9XG5cbiAgdG9rZW4gPSBzdGF0ZS5wdXNoKCd0cl9jbG9zZScsICd0cicsIC0xKVxuICB0b2tlbiA9IHN0YXRlLnB1c2goJ3RoZWFkX2Nsb3NlJywgJ3RoZWFkJywgLTEpXG5cbiAgdG9rZW4gPSBzdGF0ZS5wdXNoKCd0Ym9keV9vcGVuJywgJ3Rib2R5JywgMSlcbiAgdG9rZW4ubWFwID0gdGJvZHlMaW5lcyA9IFtzdGFydExpbmUgKyAyLCAwXVxuXG4gIGZvciAobmV4dExpbmUgPSBzdGFydExpbmUgKyAyOyBuZXh0TGluZSA8IGVuZExpbmU7IG5leHRMaW5lKyspIHtcbiAgICBpZiAoc3RhdGUuc0NvdW50W25leHRMaW5lXSA8IHN0YXRlLmJsa0luZGVudCkge1xuICAgICAgYnJlYWtcbiAgICB9XG5cbiAgICBsaW5lVGV4dCA9IGdldExpbmUoc3RhdGUsIG5leHRMaW5lKS50cmltKClcbiAgICBpZiAobGluZVRleHQuaW5kZXhPZignfCcpID09PSAtMSkge1xuICAgICAgYnJlYWtcbiAgICB9XG4gICAgY29sdW1ucyA9IGVzY2FwZWRTcGxpdChcbiAgICAgIGxpbmVUZXh0LnJlcGxhY2UoL15cXHx8XFx8JC9nLCAnJyksXG4gICAgICBvcGVuRGVsaW1zLFxuICAgICAgY2xvc2VEZWxpbXMsXG4gICAgKVxuXG4gICAgdG9rZW4gPSBzdGF0ZS5wdXNoKCd0cl9vcGVuJywgJ3RyJywgMSlcbiAgICBmb3IgKGkgPSAwOyBpIDwgY29sdW1uQ291bnQ7IGkrKykge1xuICAgICAgdG9rZW4gPSBzdGF0ZS5wdXNoKCd0ZF9vcGVuJywgJ3RkJywgMSlcbiAgICAgIGlmIChhbGlnbnNbaV0pIHtcbiAgICAgICAgdG9rZW4uYXR0cnMgPSBbWydzdHlsZScsICd0ZXh0LWFsaWduOicgKyBhbGlnbnNbaV1dXVxuICAgICAgfVxuXG4gICAgICB0b2tlbiA9IHN0YXRlLnB1c2goJ2lubGluZScsICcnLCAwKVxuICAgICAgdG9rZW4uY29udGVudCA9IGNvbHVtbnNbaV0gPyBjb2x1bW5zW2ldLnRyaW0oKSA6ICcnXG4gICAgICB0b2tlbi5jaGlsZHJlbiA9IFtdXG5cbiAgICAgIHRva2VuID0gc3RhdGUucHVzaCgndGRfY2xvc2UnLCAndGQnLCAtMSlcbiAgICB9XG4gICAgdG9rZW4gPSBzdGF0ZS5wdXNoKCd0cl9jbG9zZScsICd0cicsIC0xKVxuICB9XG4gIHRva2VuID0gc3RhdGUucHVzaCgndGJvZHlfY2xvc2UnLCAndGJvZHknLCAtMSlcbiAgdG9rZW4gPSBzdGF0ZS5wdXNoKCd0YWJsZV9jbG9zZScsICd0YWJsZScsIC0xKVxuXG4gIHRhYmxlTGluZXNbMV0gPSB0Ym9keUxpbmVzWzFdID0gbmV4dExpbmVcbiAgc3RhdGUubGluZSA9IG5leHRMaW5lXG4gIHJldHVybiB0cnVlXG59XG5cbi8qKlxuICogUHJlcGFyZSBhIHRhYmxlIHBsb2NrIHBhcnNlciB3aXRoIHJlc3RyaWN0aW9ucyBvbiBwaXBlIHBsYWNlbWVudFxuICpcbiAqIEBwYXJhbSAgc3RyaW5nIG9wZW5cbiAqICAgVGhlIG9wZW5pbmcgZGVsaW1pdGVyIHNlcXVlbmNlIGZvciBhbiBpbmxpbmUgdGhhdCBwcmV2ZW50cyBhbnkgY29udGFpbmVkXG4gKiAgIHBpcGVzIGZyb20gZGVsaW1pdGluZyBjb2x1bW5zIG9mIHRoZSBwYXJlbnQgdGFibGUgYmxvY2suXG4gKiBAcGFyYW0gIHN0cmluZyBjbG9zZVxuICogICBUaGUgY2xvc2luZyBkZWxpbWl0ZXIgc2VxdWVuY2UgZm9yIGFuIGlubGluZSB0aGF0IHByZXZlbnRzIGFueSBjb250YWluaW5nXG4gKiAgIHBpcGVzIGZyb20gZGVsaW1pdGluZyBjb2x1bW5zIG9mIHRoZSBwYXJlbnQgdGFibGUgYmxvY2suXG4gKiBAcmV0dXJuIGZ1bmN0aW9uXG4gKiAgIFRoZSB0YWJsZSBibG9jayBwYXJzZXIgdGhhdCBzaG91bGQgYmUgdXNlZCBpbiBwbGFjZSBvZiB0aGUgZXhpc3RpbmcgdGFibGVcbiAqICAgYmxvY2sgcGFyc2VyIHN1Y2ggdGhhdCB0aGUgc3BlY2lmaWVkIGlubGluZSBieSBgb3BlbmAgYW5kIGBjbG9zZWAgaXNcbiAqICAgcmVzcGVjdGVkLiBUaGUgZGVsaW1pdGVycyBhcmUgYWRkZWQgdG8gZXhpc3RpbmcgbGlzdCBvZiBkZWxpbWl0ZXIgcGFpcnMgaW5cbiAqICAgYGVzY2FwZWRTcGxpdERlbGltaXRlcnNgIGFsbG93aW5nIGBtYXJrZG93bi1pdC1tYXRoYCB0byBiZSBgdXNlYCdkIG11bHRpcGxlXG4gKiAgIHRpbWVzIGxlYWRpbmcgdG8gbXVsdGlwbGUgaW5saW5lIGRlbGltaXRlcnMuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBtYWtlVGFibGUob3B0aW9uczogT3B0aW9ucykge1xuICBjb25zdCBvcGVuRGVsaW1zID0gb3B0aW9ucy5pbmxpbmVEZWxpbS5tYXAoKGkpID0+IGlbMF0pXG4gIGNvbnN0IGNsb3NlRGVsaW1zID0gb3B0aW9ucy5pbmxpbmVEZWxpbS5tYXAoKGkpID0+IGlbMV0pXG5cbiAgb3BlbkRlbGltcy51bnNoaWZ0KCdgJylcbiAgY2xvc2VEZWxpbXMudW5zaGlmdCgnYCcpXG5cbiAgcmV0dXJuIHRhYmxlLmJpbmQobnVsbCwgb3BlbkRlbGltcywgY2xvc2VEZWxpbXMpXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3B0aW9ucyB7XG4gIGlubGluZURlbGltOiBbW3N0cmluZywgc3RyaW5nXV1cbiAgYmxvY2tEZWxpbTogW1tzdHJpbmcsIHN0cmluZ11dXG59XG4iXX0=
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/10/31/markdown-preview-plus/lib/markdown-it-math/lib/table/" data-id="ck2kdaks50025gsumffkr43p9" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-markdown-preview-plus/lib/markdown-it-helper" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/10/31/markdown-preview-plus/lib/markdown-it-helper/" class="article-date">
  <time datetime="2019-10-31T09:19:10.838Z" itemprop="datePublished">2019-10-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/31/markdown-preview-plus/lib/markdown-it-helper/">markdown-preview-plus/lib/markdown-it-helper</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        "use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const markdownItModule = require("markdown-it");
const twemoji = require("twemoji");
const path = require("path");
const util_1 = require("./util");
const lodash_1 = require("lodash");
function mathInline(text) {
    return `<span class='math inline-math'><script type='math/tex'>${text}</script></span>`;
}
function mathBlock(text) {
    return `<span class='math display-math'><script type='math/tex; mode=display'>${text}</script></span>`;
}
function getOptions(breaks) {
    return {
        html: true,
        xhtmlOut: false,
        breaks,
        langPrefix: 'lang-',
        linkify: true,
        typographer: true,
    };
}
function currentConfig(rL) {
    const config = util_1.atomConfig().markdownItConfig;
    return {
        renderLaTeX: rL,
        lazyHeaders: config.useLazyHeaders,
        checkBoxes: config.useCheckBoxes,
        toc: config.useToc,
        emoji: config.useEmoji,
        breaks: config.breakOnSingleNewline,
        criticMarkup: config.useCriticMarkup,
        footnote: config.useFootnote,
        imsize: config.useImsize,
        inlineMathSeparators: config.inlineMathSeparators,
        blockMathSeparators: config.blockMathSeparators,
        forceFullToc: config.forceFullToc,
        tocDepth: config.tocDepth,
    };
}
function init(initState) {
    const markdownIt = markdownItModule(getOptions(initState.breaks));
    if (initState.renderLaTeX) {
        const inlineDelim = util_1.pairUp(initState.inlineMathSeparators, 'inlineMathSeparators');
        const blockDelim = util_1.pairUp(initState.blockMathSeparators, 'blockMathSeparators');
        markdownIt.use(require('./markdown-it-math').math_plugin, {
            inlineDelim,
            blockDelim,
            inlineRenderer: mathInline,
            blockRenderer: mathBlock,
        });
    }
    if (initState.lazyHeaders)
        markdownIt.use(require('markdown-it-lazy-headers'));
    if (initState.checkBoxes)
        markdownIt.use(require('markdown-it-task-lists'));
    if (initState.toc) {
        markdownIt.use(require('markdown-it-anchor'));
        markdownIt.use(require('markdown-it-table-of-contents'), {
            includeLevel: Array.from({ length: initState.tocDepth }, (_, i) => i + 1),
            forceFullToc: initState.forceFullToc,
        });
    }
    if (initState.emoji) {
        markdownIt.use(require('markdown-it-emoji'));
        markdownIt.renderer.rules.emoji = function (token, idx) {
            return twemoji.parse(token[idx].content, {
                folder: path.join('assets', 'svg'),
                ext: '.svg',
                base: path.dirname(require.resolve('twemoji-assets')) + path.sep,
            });
        };
    }
    if (initState.criticMarkup) {
        markdownIt.use(require('./markdown-it-criticmarkup'));
    }
    if (initState.footnote) {
        markdownIt.use(require('markdown-it-footnote'));
    }
    if (initState.imsize)
        markdownIt.use(require('markdown-it-imsize'));
    return markdownIt;
}
function wrapInitIfNeeded(initf) {
    let markdownIt = null;
    let initState = null;
    return function (newState) {
        if (markdownIt === null || !lodash_1.isEqual(initState, newState)) {
            initState = newState;
            markdownIt = initf(newState);
        }
        return markdownIt;
    };
}
const initIfNeeded = wrapInitIfNeeded(init);
function render(text, rL) {
    const markdownIt = initIfNeeded(currentConfig(rL));
    return markdownIt.render(text);
}
exports.render = render;
function getTokens(text, rL) {
    const markdownIt = initIfNeeded(currentConfig(rL));
    return markdownIt.parse(text, {});
}
exports.getTokens = getTokens;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFya2Rvd24taXQtaGVscGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL21hcmtkb3duLWl0LWhlbHBlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGdEQUFnRDtBQUVoRCxtQ0FBa0M7QUFDbEMsNkJBQTRCO0FBQzVCLGlDQUEyQztBQUMzQyxtQ0FBZ0M7QUFJaEMsU0FBUyxVQUFVLENBQUMsSUFBWTtJQUM5QixPQUFPLDBEQUEwRCxJQUFJLGtCQUFrQixDQUFBO0FBQ3pGLENBQUM7QUFFRCxTQUFTLFNBQVMsQ0FBQyxJQUFZO0lBQzdCLE9BQU8seUVBQXlFLElBQUksa0JBQWtCLENBQUE7QUFDeEcsQ0FBQztBQUVELFNBQVMsVUFBVSxDQUFDLE1BQWU7SUFDakMsT0FBTztRQUNMLElBQUksRUFBRSxJQUFJO1FBQ1YsUUFBUSxFQUFFLEtBQUs7UUFDZixNQUFNO1FBQ04sVUFBVSxFQUFFLE9BQU87UUFDbkIsT0FBTyxFQUFFLElBQUk7UUFDYixXQUFXLEVBQUUsSUFBSTtLQUNsQixDQUFBO0FBQ0gsQ0FBQztBQUVELFNBQVMsYUFBYSxDQUFDLEVBQVc7SUFDaEMsTUFBTSxNQUFNLEdBQUcsaUJBQVUsRUFBRSxDQUFDLGdCQUFnQixDQUFBO0lBQzVDLE9BQU87UUFDTCxXQUFXLEVBQUUsRUFBRTtRQUNmLFdBQVcsRUFBRSxNQUFNLENBQUMsY0FBYztRQUNsQyxVQUFVLEVBQUUsTUFBTSxDQUFDLGFBQWE7UUFDaEMsR0FBRyxFQUFFLE1BQU0sQ0FBQyxNQUFNO1FBQ2xCLEtBQUssRUFBRSxNQUFNLENBQUMsUUFBUTtRQUN0QixNQUFNLEVBQUUsTUFBTSxDQUFDLG9CQUFvQjtRQUNuQyxZQUFZLEVBQUUsTUFBTSxDQUFDLGVBQWU7UUFDcEMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxXQUFXO1FBQzVCLE1BQU0sRUFBRSxNQUFNLENBQUMsU0FBUztRQUN4QixvQkFBb0IsRUFBRSxNQUFNLENBQUMsb0JBQW9CO1FBQ2pELG1C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SUFBSSxDQUFBO0lBQzlDLElBQUksU0FBUyxHQUFxQixJQUFJLENBQUE7SUFFdEMsT0FBTyxVQUFTLFFBQW1CO1FBQ2pDLElBQUksVUFBVSxLQUFLLElBQUksSUFBSSxDQUFDLGdCQUFPLENBQUMsU0FBUyxFQUFFLFFBQVEsQ0FBQyxFQUFFO1lBQ3hELFNBQVMsR0FBRyxRQUFRLENBQUE7WUFDcEIsVUFBVSxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQTtTQUM3QjtRQUNELE9BQU8sVUFBVSxDQUFBO0lBQ25CLENBQUMsQ0FBQTtBQUNILENBQUM7QUFFRCxNQUFNLFlBQVksR0FBRyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQTtBQUUzQyxTQUFnQixNQUFNLENBQUMsSUFBWSxFQUFFLEVBQVc7SUFDOUMsTUFBTSxVQUFVLEdBQUcsWUFBWSxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO0lBQ2xELE9BQU8sVUFBVSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQTtBQUNoQyxDQUFDO0FBSEQsd0JBR0M7QUFFRCxTQUFnQixTQUFTLENBQUMsSUFBWSxFQUFFLEVBQVc7SUFDakQsTUFBTSxVQUFVLEdBQUcsWUFBWSxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO0lBQ2xELE9BQU8sVUFBVyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUE7QUFDcEMsQ0FBQztBQUhELDhCQUdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG1hcmtkb3duSXRNb2R1bGUgPSByZXF1aXJlKCdtYXJrZG93bi1pdCcpXG5pbXBvcnQgVG9rZW4gPSByZXF1aXJlKCdtYXJrZG93bi1pdC9saWIvdG9rZW4nKVxuaW1wb3J0ICogYXMgdHdlbW9qaSBmcm9tICd0d2Vtb2ppJ1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJ1xuaW1wb3J0IHsgcGFpclVwLCBhdG9tQ29uZmlnIH0gZnJvbSAnLi91dGlsJ1xuaW1wb3J0IHsgaXNFcXVhbCB9IGZyb20gJ2xvZGFzaCdcblxudHlwZSBJbml0U3RhdGUgPSBSZWFkb25seTxSZXR1cm5UeXBlPHR5cGVvZiBjdXJyZW50Q29uZmlnPj5cblxuZnVuY3Rpb24gbWF0aElubGluZSh0ZXh0OiBzdHJpbmcpIHtcbiAgcmV0dXJuIGA8c3BhbiBjbGFzcz0nbWF0aCBpbmxpbmUtbWF0aCc+PHNjcmlwdCB0eXBlPSdtYXRoL3RleCc+JHt0ZXh0fTwvc2NyaXB0Pjwvc3Bhbj5gXG59XG5cbmZ1bmN0aW9uIG1hdGhCbG9jayh0ZXh0OiBzdHJpbmcpIHtcbiAgcmV0dXJuIGA8c3BhbiBjbGFzcz0nbWF0aCBkaXNwbGF5LW1hdGgnPjxzY3JpcHQgdHlwZT0nbWF0aC90ZXg7IG1vZGU9ZGlzcGxheSc+JHt0ZXh0fTwvc2NyaXB0Pjwvc3Bhbj5gXG59XG5cbmZ1bmN0aW9uIGdldE9wdGlvbnMoYnJlYWtzOiBib29sZWFuKSB7XG4gIHJldHVybiB7XG4gICAgaHRtbDogdHJ1ZSxcbiAgICB4aHRtbE91dDogZmFsc2UsXG4gICAgYnJlYWtzLFxuICAgIGxhbmdQcmVmaXg6ICdsYW5nLScsXG4gICAgbGlua2lmeTogdHJ1ZSxcbiAgICB0eXBvZ3JhcGhlcjogdHJ1ZSxcbiAgfVxufVxuXG5mdW5jdGlvbiBjdXJyZW50Q29uZmlnKHJMOiBib29sZWFuKSB7XG4gIGNvbnN0IGNvbmZpZyA9IGF0b21Db25maWcoKS5tYXJrZG93bkl0Q29uZmlnXG4gIHJldHVybiB7XG4gICAgcmVuZGVyTGFUZVg6IHJMLFxuICAgIGxhenlIZWFkZXJzOiBjb25maWcudXNlTGF6eUhlYWRlcnMsXG4gICAgY2hlY2tCb3hlczogY29uZmlnLnVzZUNoZWNrQm94ZXMsXG4gICAgdG9jOiBjb25maWcudXNlVG9jLFxuICAgIGVtb2ppOiBjb25maWcudXNlRW1vamksXG4gICAgYnJlYWtzOiBjb25maWcuYnJlYWtPblNpbmdsZU5ld2xpbmUsXG4gICAgY3JpdGljTWFya3VwOiBjb25maWcudXNlQ3JpdGljTWFya3VwLFxuICAgIGZvb3Rub3RlOiBjb25maWcudXNlRm9vdG5vdGUsXG4gICAgaW1zaXplOiBjb25maWcudXNlSW1zaXplLFxuICAgIGlubGluZU1hdGhTZXBhcmF0b3JzOiBjb25maWcuaW5saW5lTWF0aFNlcGFyYXRvcnMsXG4gICAgYmxvY2tNYXRoU2VwYXJhdG9yczogY29uZmlnLmJsb2NrTWF0aFNlcGFyYXRvcnMsXG4gICAgZm9yY2VGdWxsVG9jOiBjb25maWcuZm9yY2VGdWxsVG9jLFxuICAgIHRvY0RlcHRoOiBjb25maWcudG9jRGVwdGgsXG4gIH1cbn1cblxuZnVuY3Rpb24gaW5pdChpbml0U3RhdGU6IEluaXRTdGF0ZSk6IG1hcmtkb3duSXRNb2R1bGUge1xuICBjb25zdCBtYXJrZG93bkl0ID0gbWFya2Rvd25JdE1vZHVsZShnZXRPcHRpb25zKGluaXRTdGF0ZS5icmVha3MpKVxuXG4gIGlmIChpbml0U3RhdGUucmVuZGVyTGFUZVgpIHtcbiAgICBjb25zdCBpbmxpbmVEZWxpbSA9IHBhaXJVcChcbiAgICAgIGluaXRTdGF0ZS5pbmxpbmVNYXRoU2VwYXJhdG9ycyxcbiAgICAgICdpbmxpbmVNYXRoU2VwYXJhdG9ycycsXG4gICAgKVxuICAgIGNvbnN0IGJsb2NrRGVsaW0gPSBwYWlyVXAoXG4gICAgICBpbml0U3RhdGUuYmxvY2tNYXRoU2VwYXJhdG9ycyxcbiAgICAgICdibG9ja01hdGhTZXBhcmF0b3JzJyxcbiAgICApXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLXVuc2FmZS1hbnlcbiAgICBtYXJrZG93bkl0LnVzZShyZXF1aXJlKCcuL21hcmtkb3duLWl0LW1hdGgnKS5tYXRoX3BsdWdpbiwge1xuICAgICAgaW5saW5lRGVsaW0sXG4gICAgICBibG9ja0RlbGltLFxuICAgICAgaW5saW5lUmVuZGVyZXI6IG1hdGhJbmxpbmUsXG4gICAgICBibG9ja1JlbmRlcmVyOiBtYXRoQmxvY2ssXG4gICAgfSlcbiAgfVxuXG4gIC8vIHRzbGludDpkaXNhYmxlOm5vLXVuc2FmZS1hbnlcbiAgaWYgKGluaXRTdGF0ZS5sYXp5SGVhZGVycykgbWFya2Rvd25JdC51c2UocmVxdWlyZSgnbWFya2Rvd24taXQtbGF6eS1oZWFkZXJzJykpXG4gIGlmIChpbml0U3RhdGUuY2hlY2tCb3hlcykgbWFya2Rvd25JdC51c2UocmVxdWlyZSgnbWFya2Rvd24taXQtdGFzay1saXN0cycpKVxuICBpZiAoaW5pdFN0YXRlLnRvYykge1xuICAgIG1hcmtkb3duSXQudXNlKHJlcXVpcmUoJ21hcmtkb3duLWl0LWFuY2hvcicpKVxuICAgIG1hcmtkb3duSXQudXNlKHJlcXVpcmUoJ21hcmtkb3duLWl0LXRhYmxlLW9mLWNvbnRlbnRzJyksIHtcbiAgICAgIGluY2x1ZGVMZXZlbDogQXJyYXkuZnJvbSh7IGxlbmd0aDogaW5pdFN0YXRlLnRvY0RlcHRoIH0sIChfLCBpKSA9PiBpICsgMSksXG4gICAgICBmb3JjZUZ1bGxUb2M6IGluaXRTdGF0ZS5mb3JjZUZ1bGxUb2MsXG4gICAgfSlcbiAgfVxuXG4gIGlmIChpbml0U3RhdGUuZW1vamkpIHtcbiAgICBtYXJrZG93bkl0LnVzZShyZXF1aXJlKCdtYXJrZG93bi1pdC1lbW9qaScpKVxuICAgIG1hcmtkb3duSXQucmVuZGVyZXIucnVsZXMuZW1vamkgPSBmdW5jdGlvbih0b2tlbiwgaWR4KSB7XG4gICAgICByZXR1cm4gdHdlbW9qaS5wYXJzZSh0b2tlbltpZHhdLmNvbnRlbnQsIHtcbiAgICAgICAgZm9sZGVyOiBwYXRoLmpvaW4oJ2Fzc2V0cycsICdzdmcnKSxcbiAgICAgICAgZXh0OiAnLnN2ZycsXG4gICAgICAgIGJhc2U6IHBhdGguZGlybmFtZShyZXF1aXJlLnJlc29sdmUoJ3R3ZW1vamktYXNzZXRzJykpICsgcGF0aC5zZXAsXG4gICAgICB9KVxuICAgIH1cbiAgfVxuXG4gIGlmIChpbml0U3RhdGUuY3JpdGljTWFya3VwKSB7XG4gICAgbWFya2Rvd25JdC51c2UocmVxdWlyZSgnLi9tYXJrZG93bi1pdC1jcml0aWNtYXJrdXAnKSlcbiAgfVxuICBpZiAoaW5pdFN0YXRlLmZvb3Rub3RlKSB7XG4gICAgbWFya2Rvd25JdC51c2UocmVxdWlyZSgnbWFya2Rvd24taXQtZm9vdG5vdGUnKSlcbiAgfVxuICBpZiAoaW5pdFN0YXRlLmltc2l6ZSkgbWFya2Rvd25JdC51c2UocmVxdWlyZSgnbWFya2Rvd24taXQtaW1zaXplJykpXG4gIC8vIHRzbGludDplbmFibGU6bm8tdW5zYWZlLWFueVxuXG4gIHJldHVybiBtYXJrZG93bkl0XG59XG5cbmZ1bmN0aW9uIHdyYXBJbml0SWZOZWVkZWQoaW5pdGY6IHR5cGVvZiBpbml0KTogdHlwZW9mIGluaXQge1xuICBsZXQgbWFya2Rvd25JdDogbWFya2Rvd25JdE1vZHVsZSB8IG51bGwgPSBudWxsXG4gIGxldCBpbml0U3RhdGU6IEluaXRTdGF0ZSB8IG51bGwgPSBudWxsXG5cbiAgcmV0dXJuIGZ1bmN0aW9uKG5ld1N0YXRlOiBJbml0U3RhdGUpIHtcbiAgICBpZiAobWFya2Rvd25JdCA9PT0gbnVsbCB8fCAhaXNFcXVhbChpbml0U3RhdGUsIG5ld1N0YXRlKSkge1xuICAgICAgaW5pdFN0YXRlID0gbmV3U3RhdGVcbiAgICAgIG1hcmtkb3duSXQgPSBpbml0ZihuZXdTdGF0ZSlcbiAgICB9XG4gICAgcmV0dXJuIG1hcmtkb3duSXRcbiAgfVxufVxuXG5jb25zdCBpbml0SWZOZWVkZWQgPSB3cmFwSW5pdElmTmVlZGVkKGluaXQpXG5cbmV4cG9ydCBmdW5jdGlvbiByZW5kZXIodGV4dDogc3RyaW5nLCByTDogYm9vbGVhbikge1xuICBjb25zdCBtYXJrZG93bkl0ID0gaW5pdElmTmVlZGVkKGN1cnJlbnRDb25maWcockwpKVxuICByZXR1cm4gbWFya2Rvd25JdC5yZW5kZXIodGV4dClcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFRva2Vucyh0ZXh0OiBzdHJpbmcsIHJMOiBib29sZWFuKTogVG9rZW5bXSB7XG4gIGNvbnN0IG1hcmtkb3duSXQgPSBpbml0SWZOZWVkZWQoY3VycmVudENvbmZpZyhyTCkpXG4gIHJldHVybiBtYXJrZG93bkl0IS5wYXJzZSh0ZXh0LCB7fSlcbn1cbiJdfQ==
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/10/31/markdown-preview-plus/lib/markdown-it-helper/" data-id="ck2kdakqr000pgsum4pi26fke" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-markdown-preview-plus/lib/markdown-it-math/index" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/10/31/markdown-preview-plus/lib/markdown-it-math/index/" class="article-date">
  <time datetime="2019-10-31T09:19:10.838Z" itemprop="datePublished">2019-10-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/31/markdown-preview-plus/lib/markdown-it-math/index/">markdown-preview-plus/lib/markdown-it-math/index</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        "use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const table_1 = require("./lib/table");
function skipTextCommand(state, max) {
    const textCommand = state.src.slice(state.pos, state.pos + 5);
    const curPos = state.pos;
    if (textCommand === '\\text') {
        state.pos += 5;
        while (state.src[state.pos] === ' ') {
            state.pos++;
        }
        if (state.src[state.pos] !== '{') {
            state.pos = curPos;
        }
        else {
            while (state.src[state.pos] !== '}' && state.pos < max) {
                state.pos++;
            }
        }
    }
}
function scanDelims(state, start, delimLength) {
    let pos = start;
    let lastChar;
    let nextChar;
    let count;
    let canOpen;
    let canClose;
    let isLastWhiteSpace;
    let isLastPunctChar;
    let isNextWhiteSpace;
    let isNextPunctChar;
    let leftFlanking = true;
    let rightFlanking = true;
    const max = state.posMax;
    const isWhiteSpace = state.md.utils.isWhiteSpace;
    const isPunctChar = state.md.utils.isPunctChar;
    const isMdAsciiPunct = state.md.utils.isMdAsciiPunct;
    lastChar = start > 0 ? state.src.charCodeAt(start - 1) : 0x20;
    if (pos >= max) {
        canOpen = false;
    }
    pos += delimLength;
    count = pos - start;
    nextChar = pos < max ? state.src.charCodeAt(pos) : 0x20;
    isLastPunctChar =
        isMdAsciiPunct(lastChar) || isPunctChar(String.fromCharCode(lastChar));
    isNextPunctChar =
        isMdAsciiPunct(nextChar) || isPunctChar(String.fromCharCode(nextChar));
    isLastWhiteSpace = isWhiteSpace(lastChar);
    isNextWhiteSpace = isWhiteSpace(nextChar);
    if (isNextWhiteSpace) {
        leftFlanking = false;
    }
    else if (isNextPunctChar) {
        if (!(isLastWhiteSpace || isLastPunctChar)) {
            leftFlanking = false;
        }
    }
    if (isLastWhiteSpace) {
        rightFlanking = false;
    }
    else if (isLastPunctChar) {
        if (!(isNextWhiteSpace || isNextPunctChar)) {
            rightFlanking = false;
        }
    }
    canOpen = leftFlanking;
    canClose = rightFlanking;
    return {
        can_open: canOpen,
        can_close: canClose,
        delims: count,
    };
}
function makeMath_inline(delims) {
    return function math_inline(state, silent) {
        let startCount;
        let found;
        let res;
        let token;
        let closeDelim;
        const max = state.posMax;
        const start = state.pos;
        const foundDelims = delims.find(function (i) {
            const open = i[0];
            const openDelim = state.src.slice(start, start + open.length);
            return openDelim === open;
        });
        if (!foundDelims) {
            return false;
        }
        const open = foundDelims[0];
        const close = foundDelims[1];
        if (silent) {
            return false;
        }
        res = scanDelims(state, start, open.length);
        startCount = res.delims;
        if (!res.can_open) {
            state.pos += startCount;
            state.pending += state.src.slice(start, state.pos);
            return true;
        }
        state.pos = start + open.length;
        while (state.pos < max) {
            closeDelim = state.src.slice(state.pos, state.pos + close.length);
            if (closeDelim === close) {
                res = scanDelims(state, state.pos, close.length);
                if (res.can_close) {
                    found = true;
                    break;
                }
            }
            skipTextCommand(state, max);
            state.md.inline.skipToken(state);
        }
        if (!found) {
            state.pos = start;
            return false;
        }
        state.posMax = state.pos;
        state.pos = start + close.length;
        token = state.push('math_inline', 'math', 0);
        token.content = state.src.slice(state.pos, state.posMax);
        token.markup = open;
        state.pos = state.posMax + close.length;
        state.posMax = max;
        return true;
    };
}
function makeMath_block(delims) {
    return function math_block(state, startLine, endLine, silent) {
        let len;
        let nextLine;
        let token;
        let firstLine;
        let lastLine;
        let lastLinePos;
        let closeDelim;
        let haveEndMarker = false;
        let closeStartsAtNewline = false;
        let pos = state.bMarks[startLine] + state.tShift[startLine];
        let max = state.eMarks[startLine];
        const foundDelims = delims.find(function (i) {
            const open = i[0];
            const openDelim = state.src.slice(pos, pos + open.length);
            return openDelim === open;
        });
        if (!foundDelims) {
            return false;
        }
        const open = foundDelims[0];
        let close = foundDelims[1];
        if (close[0] === '\n') {
            closeStartsAtNewline = true;
            close = close.slice(1);
        }
        if (pos + open.length > max + 1) {
            return false;
        }
        pos += open.length;
        firstLine = state.src.slice(pos, max);
        if (silent) {
            return true;
        }
        if (firstLine.trim().slice(-close.length) === close) {
            firstLine = firstLine.trim().slice(0, -close.length);
            haveEndMarker = true;
        }
        nextLine = startLine;
        for (;;) {
            if (haveEndMarker) {
                break;
            }
            nextLine++;
            if (nextLine >= endLine) {
                break;
            }
            pos = state.bMarks[nextLine] + state.tShift[nextLine];
            max = state.eMarks[nextLine];
            if (pos < max && state.tShift[nextLine] < state.blkIndent) {
                break;
            }
            closeDelim = closeStartsAtNewline
                ? state.src.slice(pos, max).trim()
                : state.src
                    .slice(pos, max)
                    .trim()
                    .slice(-close.length);
            if (closeDelim !== close) {
                continue;
            }
            if (state.tShift[nextLine] - state.blkIndent >= 4) {
                continue;
            }
            lastLinePos = state.src.slice(0, max).lastIndexOf(close);
            lastLine = state.src.slice(pos, lastLinePos);
            pos += lastLine.length + close.length;
            pos = state.skipSpaces(pos);
            if (pos < max) {
                continue;
            }
            haveEndMarker = true;
        }
        len = state.tShift[startLine];
        state.line = nextLine + (haveEndMarker ? 1 : 0);
        token = state.push('math_block', 'math', 0);
        token.block = true;
        token.content =
            (firstLine && firstLine.trim() ? firstLine + '\n' : '') +
                state.getLines(startLine + 1, nextLine, len, true) +
                (lastLine && lastLine.trim() ? lastLine : '');
        token.map = [startLine, state.line];
        token.markup = open;
        return true;
    };
}
function makeMathRenderer(renderingOptions = {}) {
    return renderingOptions.display === 'block'
        ? function (tokens, idx) {
            return '<div class="math block">' + tokens[idx].content + '</div>\n';
        }
        : function (tokens, idx) {
            return '<span class="math inline">' + tokens[idx].content + '</span>';
        };
}
function math_plugin(md, options = {}) {
    const inlineDelim = options.inlineDelim || [['$$', '$$']];
    const blockDelim = options.blockDelim || [['$$$', '$$$']];
    const oInlineRenderer = options.inlineRenderer;
    const oBlockRenderer = options.blockRenderer;
    const inlineRenderer = oInlineRenderer
        ? function (tokens, idx) {
            return oInlineRenderer(tokens[idx].content);
        }
        : makeMathRenderer(options.renderingOptions);
    const blockRenderer = oBlockRenderer
        ? function (tokens, idx) {
            return oBlockRenderer(tokens[idx].content) + '\n';
        }
        : makeMathRenderer(Object.assign({ display: 'block' }, options.renderingOptions));
    const mathInline = makeMath_inline(inlineDelim);
    const mathBlock = makeMath_block(blockDelim);
    md.inline.ruler.before('escape', 'math_inline', mathInline);
    md.block.ruler.after('blockquote', 'math_block', mathBlock, {
        alt: ['paragraph', 'reference', 'blockquote', 'list'],
    });
    md.renderer.rules.math_inline = inlineRenderer;
    md.renderer.rules.math_block = blockRenderer;
    const tableBlock = table_1.makeTable({
        inlineDelim,
        blockDelim,
    });
    md.block.ruler.at('table', tableBlock, {
        alt: ['paragraph', 'reference'],
    });
}
exports.math_plugin = math_plugin;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbWFya2Rvd24taXQtbWF0aC9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUtBLHVDQUF1QztBQUV2QyxTQUFTLGVBQWUsQ0FBQyxLQUFVLEVBQUUsR0FBVztJQUM5QyxNQUFNLFdBQVcsR0FBRyxLQUFLLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUE7SUFDN0QsTUFBTSxNQUFNLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQTtJQUN4QixJQUFJLFdBQVcsS0FBSyxRQUFRLEVBQUU7UUFDNUIsS0FBSyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUE7UUFDZCxPQUFPLEtBQUssQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEdBQUcsRUFBRTtZQUNuQyxLQUFLLENBQUMsR0FBRyxFQUFFLENBQUE7U0FDWjtRQUNELElBQUksS0FBSyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEtBQUssR0FBRyxFQUFFO1lBQ2hDLEtBQUssQ0FBQyxHQUFHLEdBQUcsTUFBTSxDQUFBO1NBQ25CO2FBQU07WUFDTCxPQUFPLEtBQUssQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEdBQUcsSUFBSSxLQUFLLENBQUMsR0FBRyxHQUFHLEdBQUcsRUFBRTtnQkFDdEQsS0FBSyxDQUFDLEdBQUcsRUFBRSxDQUFBO2FBQ1o7U0FDRjtLQUNGO0FBQ0gsQ0FBQztBQUVELFNBQVMsVUFBVSxDQUFDLEtBQVUsRUFBRSxLQUFhLEVBQUUsV0FBbUI7SUFDaEUsSUFBSSxHQUFHLEdBQUcsS0FBSyxDQUFBO0lBQ2YsSUFBSSxRQUFRLENBQUE7SUFDWixJQUFJLFFBQVEsQ0FBQTtJQUNaLElBQUksS0FBSyxDQUFBO0lBQ1QsSUFBSSxPQUFP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LENBQUMsS0FBSyxDQUFDLFdBQVcsR0FBRyxjQUFjLENBQUE7SUFDOUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsVUFBVSxHQUFHLGFBQWEsQ0FBQTtJQUc1QyxNQUFNLFVBQVUsR0FBRyxpQkFBUyxDQUFDO1FBQzNCLFdBQVc7UUFDWCxVQUFVO0tBQ1gsQ0FBQyxDQUFBO0lBQ0YsRUFBRSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRSxVQUFpQixFQUFFO1FBQzVDLEdBQUcsRUFBRSxDQUFDLFdBQVcsRUFBRSxXQUFXLENBQUM7S0FDaEMsQ0FBQyxDQUFBO0FBQ0osQ0FBQztBQXJDRCxrQ0FxQ0MiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBQcm9jZXNzIGlubGluZSBtYXRoICovXG4vLyB0c2xpbnQ6ZGlzYWJsZTpuby11bnNhZmUtYW55XG5cbmltcG9ydCAqIGFzIG1kSXQgZnJvbSAnbWFya2Rvd24taXQnXG5pbXBvcnQgVG9rZW4gPSByZXF1aXJlKCdtYXJrZG93bi1pdC9saWIvdG9rZW4nKVxuaW1wb3J0IHsgbWFrZVRhYmxlIH0gZnJvbSAnLi9saWIvdGFibGUnXG5cbmZ1bmN0aW9uIHNraXBUZXh0Q29tbWFuZChzdGF0ZTogYW55LCBtYXg6IG51bWJlcikge1xuICBjb25zdCB0ZXh0Q29tbWFuZCA9IHN0YXRlLnNyYy5zbGljZShzdGF0ZS5wb3MsIHN0YXRlLnBvcyArIDUpXG4gIGNvbnN0IGN1clBvcyA9IHN0YXRlLnBvc1xuICBpZiAodGV4dENvbW1hbmQgPT09ICdcXFxcdGV4dCcpIHtcbiAgICBzdGF0ZS5wb3MgKz0gNVxuICAgIHdoaWxlIChzdGF0ZS5zcmNbc3RhdGUucG9zXSA9PT0gJyAnKSB7XG4gICAgICBzdGF0ZS5wb3MrK1xuICAgIH1cbiAgICBpZiAoc3RhdGUuc3JjW3N0YXRlLnBvc10gIT09ICd7Jykge1xuICAgICAgc3RhdGUucG9zID0gY3VyUG9zXG4gICAgfSBlbHNlIHtcbiAgICAgIHdoaWxlIChzdGF0ZS5zcmNbc3RhdGUucG9zXSAhPT0gJ30nICYmIHN0YXRlLnBvcyA8IG1heCkge1xuICAgICAgICBzdGF0ZS5wb3MrK1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBzY2FuRGVsaW1zKHN0YXRlOiBhbnksIHN0YXJ0OiBudW1iZXIsIGRlbGltTGVuZ3RoOiBudW1iZXIpIHtcbiAgbGV0IHBvcyA9IHN0YXJ0XG4gIGxldCBsYXN0Q2hhclxuICBsZXQgbmV4dENoYXJcbiAgbGV0IGNvdW50XG4gIGxldCBjYW5PcGVuXG4gIGxldCBjYW5DbG9zZVxuICBsZXQgaXNMYXN0V2hpdGVTcGFjZVxuICBsZXQgaXNMYXN0UHVuY3RDaGFyXG4gIGxldCBpc05leHRXaGl0ZVNwYWNlXG4gIGxldCBpc05leHRQdW5jdENoYXJcbiAgbGV0IGxlZnRGbGFua2luZyA9IHRydWVcbiAgbGV0IHJpZ2h0RmxhbmtpbmcgPSB0cnVlXG4gIGNvbnN0IG1heCA9IHN0YXRlLnBvc01heFxuICBjb25zdCBpc1doaXRlU3BhY2UgPSBzdGF0ZS5tZC51dGlscy5pc1doaXRlU3BhY2VcbiAgY29uc3QgaXNQdW5jdENoYXIgPSBzdGF0ZS5tZC51dGlscy5pc1B1bmN0Q2hhclxuICBjb25zdCBpc01kQXNjaWlQdW5jdCA9IHN0YXRlLm1kLnV0aWxzLmlzTWRBc2NpaVB1bmN0XG5cbiAgLy8gdHJlYXQgYmVnaW5uaW5nIG9mIHRoZSBsaW5lIGFzIGEgd2hpdGVzcGFjZVxuICBsYXN0Q2hhciA9IHN0YXJ0ID4gMCA/IHN0YXRlLnNyYy5jaGFyQ29kZUF0KHN0YXJ0IC0gMSkgOiAweDIwXG5cbiAgaWYgKHBvcyA+PSBtYXgpIHtcbiAgICBjYW5PcGVuID0gZmFsc2VcbiAgfVxuXG4gIHBvcyArPSBkZWxpbUxlbmd0aFxuXG4gIGNvdW50ID0gcG9zIC0gc3RhcnRcblxuICAvLyB0cmVhdCBlbmQgb2YgdGhlIGxpbmUgYXMgYSB3aGl0ZXNwYWNlXG4gIG5leHRDaGFyID0gcG9zIDwgbWF4ID8gc3RhdGUuc3JjLmNoYXJDb2RlQXQocG9zKSA6IDB4MjBcblxuICBpc0xhc3RQdW5jdENoYXIgPVxuICAgIGlzTWRBc2NpaVB1bmN0KGxhc3RDaGFyKSB8fCBpc1B1bmN0Q2hhcihTdHJpbmcuZnJvbUNoYXJDb2RlKGxhc3RDaGFyKSlcbiAgaXNOZXh0UHVuY3RDaGFyID1cbiAgICBpc01kQXNjaWlQdW5jdChuZXh0Q2hhcikgfHwgaXNQdW5jdENoYXIoU3RyaW5nLmZyb21DaGFyQ29kZShuZXh0Q2hhcikpXG5cbiAgaXNMYXN0V2hpdGVTcGFjZSA9IGlzV2hpdGVTcGFjZShsYXN0Q2hhcilcbiAgaXNOZXh0V2hpdGVTcGFjZSA9IGlzV2hpdGVTcGFjZShuZXh0Q2hhcilcblxuICBpZiAoaXNOZXh0V2hpdGVTcGFjZSkge1xuICAgIGxlZnRGbGFua2luZyA9IGZhbHNlXG4gIH0gZWxzZSBpZiAoaXNOZXh0UHVuY3RDaGFyKSB7XG4gICAgaWYgKCEoaXNMYXN0V2hpdGVTcGFjZSB8fCBpc0xhc3RQdW5jdENoYXIpKSB7XG4gICAgICBsZWZ0RmxhbmtpbmcgPSBmYWxzZVxuICAgIH1cbiAgfVxuXG4gIGlmIChpc0xhc3RXaGl0ZVNwYWNlKSB7XG4gICAgcmlnaHRGbGFua2luZyA9IGZhbHNlXG4gIH0gZWxzZSBpZiAoaXNMYXN0UHVuY3RDaGFyKSB7XG4gICAgaWYgKCEoaXNOZXh0V2hpdGVTcGFjZSB8fCBpc05leHRQdW5jdENoYXIpKSB7XG4gICAgICByaWdodEZsYW5raW5nID0gZmFsc2VcbiAgICB9XG4gIH1cblxuICBjYW5PcGVuID0gbGVmdEZsYW5raW5nXG4gIGNhbkNsb3NlID0gcmlnaHRGbGFua2luZ1xuXG4gIHJldHVybiB7XG4gICAgY2FuX29wZW46IGNhbk9wZW4sXG4gICAgY2FuX2Nsb3NlOiBjYW5DbG9zZSxcbiAgICBkZWxpbXM6IGNvdW50LFxuICB9XG59XG5cbmZ1bmN0aW9uIG1ha2VNYXRoX2lubGluZShkZWxpbXM6IFtbc3RyaW5nLCBzdHJpbmddXSkge1xuICByZXR1cm4gZnVuY3Rpb24gbWF0aF9pbmxpbmUoc3RhdGU6IGFueSwgc2lsZW50OiBib29sZWFuKSB7XG4gICAgbGV0IHN0YXJ0Q291bnRcbiAgICBsZXQgZm91bmRcbiAgICBsZXQgcmVzXG4gICAgbGV0IHRva2VuXG4gICAgbGV0IGNsb3NlRGVsaW1cbiAgICBjb25zdCBtYXggPSBzdGF0ZS5wb3NNYXggYXMgbnVtYmVyXG4gICAgY29uc3Qgc3RhcnQgPSBzdGF0ZS5wb3MgYXMgbnVtYmVyXG4gICAgY29uc3QgZm91bmREZWxpbXMgPSBkZWxpbXMuZmluZChmdW5jdGlvbihpKSB7XG4gICAgICBjb25zdCBvcGVuID0gaVswXVxuICAgICAgY29uc3Qgb3BlbkRlbGltID0gc3RhdGUuc3JjLnNsaWNlKHN0YXJ0LCBzdGFydCArIG9wZW4ubGVuZ3RoKSBhcyBzdHJpbmdcbiAgICAgIHJldHVybiBvcGVuRGVsaW0gPT09IG9wZW5cbiAgICB9KVxuICAgIGlmICghZm91bmREZWxpbXMpIHtcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgICBjb25zdCBvcGVuID0gZm91bmREZWxpbXNbMF1cbiAgICBjb25zdCBjbG9zZSA9IGZvdW5kRGVsaW1zWzFdXG4gICAgaWYgKHNpbGVudCkge1xuICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfSAvLyBEb27igJl0IHJ1biBhbnkgcGFpcnMgaW4gdmFsaWRhdGlvbiBtb2RlXG5cbiAgICByZXMgPSBzY2FuRGVsaW1zKHN0YXRlLCBzdGFydCwgb3Blbi5sZW5ndGgpXG4gICAgc3RhcnRDb3VudCA9IHJlcy5kZWxpbXNcblxuICAgIGlmICghcmVzLmNhbl9vcGVuKSB7XG4gICAgICBzdGF0ZS5wb3MgKz0gc3RhcnRDb3VudFxuICAgICAgLy8gRWFybGllciB3ZSBjaGVja2VkICFzaWxlbnQsIGJ1dCB0aGlzIGltcGxlbWVudGF0aW9uIGRvZXMgbm90IG5lZWQgaXRcbiAgICAgIHN0YXRlLnBlbmRpbmcgKz0gc3RhdGUuc3JjLnNsaWNlKHN0YXJ0LCBzdGF0ZS5wb3MpXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cblxuICAgIHN0YXRlLnBvcyA9IHN0YXJ0ICsgb3Blbi5sZW5ndGhcblxuICAgIHdoaWxlIChzdGF0ZS5wb3MgPCBtYXgpIHtcbiAgICAgIGNsb3NlRGVsaW0gPSBzdGF0ZS5zcmMuc2xpY2Uoc3RhdGUucG9zLCBzdGF0ZS5wb3MgKyBjbG9zZS5sZW5ndGgpXG4gICAgICBpZiAoY2xvc2VEZWxpbSA9PT0gY2xvc2UpIHtcbiAgICAgICAgcmVzID0gc2NhbkRlbGltcyhzdGF0ZSwgc3RhdGUucG9zLCBjbG9zZS5sZW5ndGgpXG4gICAgICAgIGlmIChyZXMuY2FuX2Nsb3NlKSB7XG4gICAgICAgICAgZm91bmQgPSB0cnVlXG4gICAgICAgICAgYnJlYWtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgc2tpcFRleHRDb21tYW5kKHN0YXRlLCBtYXgpXG5cbiAgICAgIHN0YXRlLm1kLmlubGluZS5za2lwVG9rZW4oc3RhdGUpXG4gICAgfVxuXG4gICAgaWYgKCFmb3VuZCkge1xuICAgICAgLy8gUGFyc2VyIGZhaWxlZCB0byBmaW5kIGVuZGluZyB0YWcsIHNvIGl0IGlzIG5vdCBhIHZhbGlkIG1hdGhcbiAgICAgIHN0YXRlLnBvcyA9IHN0YXJ0XG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG5cbiAgICAvLyBGb3VuZCFcbiAgICBzdGF0ZS5wb3NNYXggPSBzdGF0ZS5wb3NcbiAgICBzdGF0ZS5wb3MgPSBzdGFydCArIGNsb3NlLmxlbmd0aFxuXG4gICAgLy8gRWFybGllciB3ZSBjaGVja2VkICFzaWxlbnQsIGJ1dCB0aGlzIGltcGxlbWVudGF0aW9uIGRvZXMgbm90IG5lZWQgaXRcbiAgICB0b2tlbiA9IHN0YXRlLnB1c2goJ21hdGhfaW5saW5lJywgJ21hdGgnLCAwKVxuICAgIHRva2VuLmNvbnRlbnQgPSBzdGF0ZS5zcmMuc2xpY2Uoc3RhdGUucG9zLCBzdGF0ZS5wb3NNYXgpXG4gICAgdG9rZW4ubWFya3VwID0gb3BlblxuXG4gICAgc3RhdGUucG9zID0gc3RhdGUucG9zTWF4ICsgY2xvc2UubGVuZ3RoXG4gICAgc3RhdGUucG9zTWF4ID0gbWF4XG5cbiAgICByZXR1cm4gdHJ1ZVxuICB9XG59XG5cbmZ1bmN0aW9uIG1ha2VNYXRoX2Jsb2NrKGRlbGltczogW1tzdHJpbmcsIHN0cmluZ11dKSB7XG4gIHJldHVybiBmdW5jdGlvbiBtYXRoX2Jsb2NrKFxuICAgIHN0YXRlOiBhbnksXG4gICAgc3RhcnRMaW5lOiBudW1iZXIsXG4gICAgZW5kTGluZTogbnVtYmVyLFxuICAgIHNpbGVudDogYm9vbGVhbixcbiAgKSB7XG4gICAgbGV0IGxlblxuICAgIGxldCBuZXh0TGluZVxuICAgIGxldCB0b2tlblxuICAgIGxldCBmaXJzdExpbmU6IHN0cmluZ1xuICAgIGxldCBsYXN0TGluZVxuICAgIGxldCBsYXN0TGluZVBvc1xuICAgIGxldCBjbG9zZURlbGltXG4gICAgbGV0IGhhdmVFbmRNYXJrZXIgPSBmYWxzZVxuICAgIGxldCBjbG9zZVN0YXJ0c0F0TmV3bGluZSA9IGZhbHNlXG4gICAgbGV0IHBvczogbnVtYmVyID0gc3RhdGUuYk1hcmtzW3N0YXJ0TGluZV0gKyBzdGF0ZS50U2hpZnRbc3RhcnRMaW5lXVxuICAgIGxldCBtYXg6IG51bWJlciA9IHN0YXRlLmVNYXJrc1tzdGFydExpbmVdXG5cbiAgICBjb25zdCBmb3VuZERlbGltcyA9IGRlbGltcy5maW5kKGZ1bmN0aW9uKGkpIHtcbiAgICAgIGNvbnN0IG9wZW4gPSBpWzBdXG4gICAgICBjb25zdCBvcGVuRGVsaW0gPSBzdGF0ZS5zcmMuc2xpY2UocG9zLCBwb3MgKyBvcGVuLmxlbmd0aClcbiAgICAgIHJldHVybiBvcGVuRGVsaW0gPT09IG9wZW5cbiAgICB9KVxuICAgIGlmICghZm91bmREZWxpbXMpIHtcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgICBjb25zdCBvcGVuID0gZm91bmREZWxpbXNbMF1cbiAgICBsZXQgY2xvc2UgPSBmb3VuZERlbGltc1sxXVxuXG4gICAgaWYgKGNsb3NlWzBdID09PSAnXFxuJykge1xuICAgICAgY2xvc2VTdGFydHNBdE5ld2xpbmUgPSB0cnVlXG4gICAgICBjbG9zZSA9IGNsb3NlLnNsaWNlKDEpXG4gICAgfVxuXG4gICAgaWYgKHBvcyArIG9wZW4ubGVuZ3RoID4gbWF4ICsgMSkge1xuICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuXG4gICAgcG9zICs9IG9wZW4ubGVuZ3RoXG4gICAgZmlyc3RMaW5lID0gc3RhdGUuc3JjLnNsaWNlKHBvcywgbWF4KVxuXG4gICAgLy8gU2luY2Ugc3RhcnQgaXMgZm91bmQsIHdlIGNhbiByZXBvcnQgc3VjY2VzcyBoZXJlIGluIHZhbGlkYXRpb24gbW9kZVxuICAgIGlmIChzaWxlbnQpIHtcbiAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuXG4gICAgaWYgKGZpcnN0TGluZS50cmltKCkuc2xpY2UoLWNsb3NlLmxlbmd0aCkgPT09IGNsb3NlKSB7XG4gICAgICAvLyBTaW5nbGUgbGluZSBleHByZXNzaW9uXG4gICAgICBmaXJzdExpbmUgPSBmaXJzdExpbmUudHJpbSgpLnNsaWNlKDAsIC1jbG9zZS5sZW5ndGgpXG4gICAgICBoYXZlRW5kTWFya2VyID0gdHJ1ZVxuICAgIH1cblxuICAgIC8vIHNlYXJjaCBlbmQgb2YgYmxvY2tcbiAgICBuZXh0TGluZSA9IHN0YXJ0TGluZVxuXG4gICAgZm9yICg7Oykge1xuICAgICAgaWYgKGhhdmVFbmRNYXJrZXIpIHtcbiAgICAgICAgYnJlYWtcbiAgICAgIH1cblxuICAgICAgbmV4dExpbmUrK1xuXG4gICAgICBpZiAobmV4dExpbmUgPj0gZW5kTGluZSkge1xuICAgICAgICAvLyB1bmNsb3NlZCBibG9jayBzaG91bGQgYmUgYXV0b2Nsb3NlZCBieSBlbmQgb2YgZG9jdW1lbnQuXG4gICAgICAgIC8vIGFsc28gYmxvY2sgc2VlbXMgdG8gYmUgYXV0b2Nsb3NlZCBieSBlbmQgb2YgcGFyZW50XG4gICAgICAgIGJyZWFrXG4gICAgICB9XG5cbiAgICAgIHBvcyA9IHN0YXRlLmJNYXJrc1tuZXh0TGluZV0gKyBzdGF0ZS50U2hpZnRbbmV4dExpbmVdXG4gICAgICBtYXggPSBzdGF0ZS5lTWFya3NbbmV4dExpbmVdXG5cbiAgICAgIGlmIChwb3MgPCBtYXggJiYgc3RhdGUudFNoaWZ0W25leHRMaW5lXSA8IHN0YXRlLmJsa0luZGVudCkge1xuICAgICAgICAvLyBub24tZW1wdHkgbGluZSB3aXRoIG5lZ2F0aXZlIGluZGVudCBzaG91bGQgc3RvcCB0aGUgbGlzdDpcbiAgICAgICAgYnJlYWtcbiAgICAgIH1cblxuICAgICAgY2xvc2VEZWxpbSA9IGNsb3NlU3RhcnRzQXROZXdsaW5lXG4gICAgICAgID8gc3RhdGUuc3JjLnNsaWNlKHBvcywgbWF4KS50cmltKClcbiAgICAgICAgOiBzdGF0ZS5zcmNcbiAgICAgICAgICAgIC5zbGljZShwb3MsIG1heClcbiAgICAgICAgICAgIC50cmltKClcbiAgICAgICAgICAgIC5zbGljZSgtY2xvc2UubGVuZ3RoKVxuXG4gICAgICBpZiAoY2xvc2VEZWxpbSAhPT0gY2xvc2UpIHtcbiAgICAgICAgY29udGludWVcbiAgICAgIH1cblxuICAgICAgaWYgKHN0YXRlLnRTaGlmdFtuZXh0TGluZV0gLSBzdGF0ZS5ibGtJbmRlbnQgPj0gNCkge1xuICAgICAgICAvLyBjbG9zaW5nIGJsb2NrIG1hdGggc2hvdWxkIGJlIGluZGVudGVkIGxlc3MgdGhlbiA0IHNwYWNlc1xuICAgICAgICBjb250aW51ZVxuICAgICAgfVxuXG4gICAgICBsYXN0TGluZVBvcyA9IHN0YXRlLnNyYy5zbGljZSgwLCBtYXgpLmxhc3RJbmRleE9mKGNsb3NlKVxuICAgICAgbGFzdExpbmUgPSBzdGF0ZS5zcmMuc2xpY2UocG9zLCBsYXN0TGluZVBvcylcblxuICAgICAgcG9zICs9IGxhc3RMaW5lLmxlbmd0aCArIGNsb3NlLmxlbmd0aFxuXG4gICAgICAvLyBtYWtlIHN1cmUgdGFpbCBoYXMgc3BhY2VzIG9ubHlcbiAgICAgIHBvcyA9IHN0YXRlLnNraXBTcGFjZXMocG9zKVxuXG4gICAgICBpZiAocG9zIDwgbWF4KSB7XG4gICAgICAgIGNvbnRpbnVlXG4gICAgICB9XG5cbiAgICAgIC8vIGZvdW5kIVxuICAgICAgaGF2ZUVuZE1hcmtlciA9IHRydWVcbiAgICB9XG5cbiAgICAvLyBJZiBtYXRoIGJsb2NrIGhhcyBoZWFkaW5nIHNwYWNlcywgdGhleSBzaG91bGQgYmUgcmVtb3ZlZCBmcm9tIGl0cyBpbm5lciBibG9ja1xuICAgIGxlbiA9IHN0YXRlLnRTaGlmdFtzdGFydExpbmVdXG5cbiAgICBzdGF0ZS5saW5lID0gbmV4dExpbmUgKyAoaGF2ZUVuZE1hcmtlciA/IDEgOiAwKVxuXG4gICAgdG9rZW4gPSBzdGF0ZS5wdXNoKCdtYXRoX2Jsb2NrJywgJ21hdGgnLCAwKVxuICAgIHRva2VuLmJsb2NrID0gdHJ1ZVxuICAgIHRva2VuLmNvbnRlbnQgPVxuICAgICAgKGZpcnN0TGluZSAmJiBmaXJzdExpbmUudHJpbSgpID8gZmlyc3RMaW5lICsgJ1xcbicgOiAnJykgK1xuICAgICAgc3RhdGUuZ2V0TGluZXMoc3RhcnRMaW5lICsgMSwgbmV4dExpbmUsIGxlbiwgdHJ1ZSkgK1xuICAgICAgKGxhc3RMaW5lICYmIGxhc3RMaW5lLnRyaW0oKSA/IGxhc3RMaW5lIDogJycpXG4gICAgdG9rZW4ubWFwID0gW3N0YXJ0TGluZSwgc3RhdGUubGluZV1cbiAgICB0b2tlbi5tYXJrdXAgPSBvcGVuXG5cbiAgICByZXR1cm4gdHJ1ZVxuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVuZGVyaW5nT3B0aW9ucyB7XG4gIGRpc3BsYXk/OiAnYmxvY2snXG59XG5cbmZ1bmN0aW9uIG1ha2VNYXRoUmVuZGVyZXIocmVuZGVyaW5nT3B0aW9uczogUmVuZGVyaW5nT3B0aW9ucyA9IHt9KSB7XG4gIHJldHVybiByZW5kZXJpbmdPcHRpb25zLmRpc3BsYXkgPT09ICdibG9jaydcbiAgICA/IGZ1bmN0aW9uKHRva2VuczogVG9rZW5bXSwgaWR4OiBudW1iZXIpIHtcbiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPVwibWF0aCBibG9ja1wiPicgKyB0b2tlbnNbaWR4XS5jb250ZW50ICsgJzwvZGl2PlxcbidcbiAgICAgIH1cbiAgICA6IGZ1bmN0aW9uKHRva2VuczogVG9rZW5bXSwgaWR4OiBudW1iZXIpIHtcbiAgICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz1cIm1hdGggaW5saW5lXCI+JyArIHRva2Vuc1tpZHhdLmNvbnRlbnQgKyAnPC9zcGFuPidcbiAgICAgIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBQbHVnaW5PcHRpb25zIHtcbiAgaW5saW5lRGVsaW0/OiBbW3N0cmluZywgc3RyaW5nXV1cbiAgYmxvY2tEZWxpbT86IFtbc3RyaW5nLCBzdHJpbmddXVxuICBpbmxpbmVSZW5kZXJlcj86IChkYXRhOiBzdHJpbmcpID0+IHN0cmluZ1xuICBibG9ja1JlbmRlcmVyPzogKGRhdGE6IHN0cmluZykgPT4gc3RyaW5nXG4gIHJlbmRlcmluZ09wdGlvbnM/OiBSZW5kZXJpbmdPcHRpb25zXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtYXRoX3BsdWdpbihtZDogbWRJdCwgb3B0aW9uczogUGx1Z2luT3B0aW9ucyA9IHt9KSB7XG4gIC8vIERlZmF1bHQgb3B0aW9uc1xuICBjb25zdCBpbmxpbmVEZWxpbSA9IG9wdGlvbnMuaW5saW5lRGVsaW0gfHwgW1snJCQnLCAnJCQnXV1cbiAgY29uc3QgYmxvY2tEZWxpbSA9IG9wdGlvbnMuYmxvY2tEZWxpbSB8fCBbWyckJCQnLCAnJCQkJ11dXG4gIGNvbnN0IG9JbmxpbmVSZW5kZXJlciA9IG9wdGlvbnMuaW5saW5lUmVuZGVyZXJcbiAgY29uc3Qgb0Jsb2NrUmVuZGVyZXIgPSBvcHRpb25zLmJsb2NrUmVuZGVyZXJcbiAgY29uc3QgaW5saW5lUmVuZGVyZXIgPSBvSW5saW5lUmVuZGVyZXJcbiAgICA/IGZ1bmN0aW9uKHRva2VuczogVG9rZW5bXSwgaWR4OiBudW1iZXIpIHtcbiAgICAgICAgcmV0dXJuIG9JbmxpbmVSZW5kZXJlcih0b2tlbnNbaWR4XS5jb250ZW50KVxuICAgICAgfVxuICAgIDogbWFrZU1hdGhSZW5kZXJlcihvcHRpb25zLnJlbmRlcmluZ09wdGlvbnMpXG4gIGNvbnN0IGJsb2NrUmVuZGVyZXIgPSBvQmxvY2tSZW5kZXJlclxuICAgID8gZnVuY3Rpb24odG9rZW5zOiBUb2tlbltdLCBpZHg6IG51bWJlcikge1xuICAgICAgICByZXR1cm4gb0Jsb2NrUmVuZGVyZXIodG9rZW5zW2lkeF0uY29udGVudCkgKyAnXFxuJ1xuICAgICAgfVxuICAgIDogbWFrZU1hdGhSZW5kZXJlcihcbiAgICAgICAgT2JqZWN0LmFzc2lnbih7IGRpc3BsYXk6ICdibG9jaycgfSwgb3B0aW9ucy5yZW5kZXJpbmdPcHRpb25zKSxcbiAgICAgIClcblxuICBjb25zdCBtYXRoSW5saW5lID0gKG1ha2VNYXRoX2lubGluZShpbmxpbmVEZWxpbSkgYXMgYW55KSBhcyBtZEl0LlJ1bGVcbiAgY29uc3QgbWF0aEJsb2NrID0gKG1ha2VNYXRoX2Jsb2NrKGJsb2NrRGVsaW0pIGFzIGFueSkgYXMgbWRJdC5SdWxlXG5cbiAgbWQuaW5saW5lLnJ1bGVyLmJlZm9yZSgnZXNjYXBlJywgJ21hdGhfaW5saW5lJywgbWF0aElubGluZSlcbiAgbWQuYmxvY2sucnVsZXIuYWZ0ZXIoJ2Jsb2NrcXVvdGUnLCAnbWF0aF9ibG9jaycsIG1hdGhCbG9jaywge1xuICAgIGFsdDogWydwYXJhZ3JhcGgnLCAncmVmZXJlbmNlJywgJ2Jsb2NrcXVvdGUnLCAnbGlzdCddLFxuICB9KVxuICBtZC5yZW5kZXJlci5ydWxlcy5tYXRoX2lubGluZSA9IGlubGluZVJlbmRlcmVyXG4gIG1kLnJlbmRlcmVyLnJ1bGVzLm1hdGhfYmxvY2sgPSBibG9ja1JlbmRlcmVyXG5cbiAgLy8gUmVwbGFjZSBleGlzdGluZyB0YWJsZSBwYXJzZXIgd2l0aCBwYXJzZXIgdGhhdCByZXNwZWN0cyBuZXcgaW5saW5lIGRlbGltc1xuICBjb25zdCB0YWJsZUJsb2NrID0gbWFrZVRhYmxlKHtcbiAgICBpbmxpbmVEZWxpbSxcbiAgICBibG9ja0RlbGltLFxuICB9KVxuICBtZC5ibG9jay5ydWxlci5hdCgndGFibGUnLCB0YWJsZUJsb2NrIGFzIGFueSwge1xuICAgIGFsdDogWydwYXJhZ3JhcGgnLCAncmVmZXJlbmNlJ10sXG4gIH0pXG59XG4iXX0=
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/10/31/markdown-preview-plus/lib/markdown-it-math/index/" data-id="ck2kdakrg0018gsum3pegbwu5" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-markdown-preview-plus/lib/markdown-it-criticmarkup/index" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/10/31/markdown-preview-plus/lib/markdown-it-criticmarkup/index/" class="article-date">
  <time datetime="2019-10-31T09:19:10.837Z" itemprop="datePublished">2019-10-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/31/markdown-preview-plus/lib/markdown-it-criticmarkup/index/">markdown-preview-plus/lib/markdown-it-criticmarkup/index</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        "use strict";
const specialChars = ['-', '+', '~', '=', '>'];
function isOpening(str, pos) {
    if (str[pos] === '{' &&
        specialChars.includes(str[pos + 1]) &&
        str[pos + 2] === str[pos + 1]) {
        const op = str.slice(pos + 1, pos + 3);
        const cl = op[0] === '>' ? '<<}' : op + '}';
        return [op, cl];
    }
    else {
        return null;
    }
}
function criticInline(state, silent) {
    const { src, pos } = state;
    const tags = isOpening(src, pos);
    if (tags === null)
        return false;
    const [opening, closing] = tags;
    const endPos = src.indexOf(closing, pos + 3);
    const content = endPos >= 0 ? src.slice(pos + 3, endPos) : null;
    if (content === null)
        return false;
    if (silent)
        return true;
    const token = state.push('critic-markup');
    token.content = content;
    token.tag = opening;
    state.pos = endPos + closing.length;
    return true;
}
function criticRender(tokens, idx) {
    const token = tokens[idx];
    const tag = token.tag;
    const content = token.content;
    if (tag === '--') {
        return `<del>${content}</del>`;
    }
    else if (tag === '++') {
        return `<ins>${content}</ins>`;
    }
    else if (tag === '==') {
        return `<mark>${content}</mark>`;
    }
    else if (tag === '>>') {
        return `<span tabindex="-1" class="critic comment"><span>${content}</span></span>`;
    }
    else {
        const arr = content.split('~>');
        if (arr.length === 2) {
            return `<del>${arr[0]}</del><ins>${arr[1]}</ins>`;
        }
        else {
            return `<code>Error: ~> not found.</code>`;
        }
    }
}
module.exports = function (md) {
    md.inline.ruler.before('strikethrough', 'critic-markup', criticInline);
    md.renderer.rules['critic-markup'] = criticRender;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbWFya2Rvd24taXQtY3JpdGljbWFya3VwL2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFtQkEsTUFBTSxZQUFZLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUE7QUFFOUMsU0FBUyxTQUFTLENBQUMsR0FBVyxFQUFFLEdBQVc7SUFDekMsSUFDRSxHQUFHLENBQUMsR0FBRyxDQUFDLEtBQUssR0FBRztRQUNoQixZQUFZLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDbkMsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxFQUM3QjtRQUNBLE1BQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxHQUFHLENBQUMsRUFBRSxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUE7UUFDdEMsTUFBTSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLEdBQUcsR0FBRyxDQUFBO1FBQzNDLE9BQU8sQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUE7S0FDaEI7U0FBTTtRQUNMLE9BQU8sSUFBSSxDQUFBO0tBQ1o7QUFDSCxDQUFDO0FBRUQsU0FBUyxZQUFZLENBQ25CLEtBQW1FLEVBQ25FLE1BQWU7SUFFZixNQUFNLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEtBQUssQ0FBQTtJQUMxQixNQUFNLElBQUksR0FBRyxTQUFTLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFBO0lBQ2hDLElBQUksSUFBSSxLQUFLLElBQUk7UUFBRSxPQUFPLEtBQUssQ0FBQTtJQUMvQixNQUFNLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxHQUFHLElBQUksQ0FBQTtJQUMvQixNQUFNLE1BQU0sR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUE7SUFDNUMsTUFBTSxPQUFPLEdBQUcsTUFBTSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLEdBQUcsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUE7SUFDL0QsSUFBSSxPQUFPLEtBQUssSUFBSTtRQUFFLE9BQU8sS0FBSyxDQUFBO0lBQ2xDLElBQUksTUFBTTtRQUFFLE9BQU8sSUFBSSxDQUFBO0lBQ3ZCLE1BQU0sS0FBSyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUE7SUFDekMsS0FBSyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUE7SUFDdkIsS0FBSyxDQUFDLEdBQUcsR0FBRyxPQUFPLENBQUE7SUFDbkIsS0FBSyxDQUFDLEdBQUcsR0FBRyxNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQTtJQUNuQyxPQUFPLElBQUksQ0FBQTtBQUNiLENBQUM7QUFFRCxTQUFTLFlBQVksQ0FBQyxNQUFlLEVBQUUsR0FBVztJQUNoRCxNQUFNLEtBQUssR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUE7SUFDekIsTUFBTSxHQUFHLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQTtJQUNyQixNQUFNLE9BQU8sR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFBO0lBQzdCLElBQUksR0FBRyxLQUFLLElBQUksRUFBRTtRQUNoQixPQUFPLFFBQVEsT0FBTyxRQUFRLENBQUE7S0FDL0I7U0FBTSxJQUFJLEdBQUcsS0FBSyxJQUFJLEVBQUU7UUFDdkIsT0FBTyxRQUFRLE9BQU8sUUFBUSxDQUFBO0tBQy9CO1NBQU0sSUFBSSxHQUFHLEtBQUssSUFBSSxFQUFFO1FBQ3ZCLE9BQU8sU0FBUyxPQUFPLFNBQVMsQ0FBQTtLQUNqQztTQUFNLElBQUksR0FBRyxLQUFLLElBQUksRUFBRTtRQUN2QixPQUFPLG9EQUFvRCxPQUFPLGdCQUFnQixDQUFBO0tBQ25GO1NBQU07UUFFTCxNQUFNLEdBQUcsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFBO1FBQy9CLElBQUksR0FBRyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7WUFDcEIsT0FBTyxRQUFRLEdBQUcsQ0FBQyxDQUFDLENBQUMsY0FBYyxHQUFHLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQTtTQUNsRDthQUFNO1lBQ0wsT0FBTyxtQ0FBbUMsQ0FBQTtTQUMzQztLQUNGO0FBQ0gsQ0FBQztBQUVELGlCQUFTLFVBQVMsRUFBUTtJQUN4QixFQUFFLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsZUFBZSxFQUFFLGVBQWUsRUFBRSxZQUFtQixDQUFDLENBQUE7SUFDN0UsRUFBRSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsZUFBZSxDQUFDLEdBQUcsWUFBWSxDQUFBO0FBQ25ELENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIFRoaXMgZmlsZSBpbmNvcnBvcmF0ZXMgY29kZSBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS93YWZlci1saS9tYXJrZG93bi1pdC1jcml0aWNtYXJrdXBcbi8vIGNvdmVyZWQgYnkgdGhlIGZvbGxvd2luZyB0ZXJtczpcbi8vIENvcHlyaWdodCAyMDE3IFdhZmVyIExpXG4vL1xuLy8gUGVybWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgYW5kL29yIGRpc3RyaWJ1dGUgdGhpcyBzb2Z0d2FyZSBmb3IgYW55XG4vLyBwdXJwb3NlIHdpdGggb3Igd2l0aG91dCBmZWUgaXMgaGVyZWJ5IGdyYW50ZWQsIHByb3ZpZGVkIHRoYXQgdGhlIGFib3ZlXG4vLyBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIGFwcGVhciBpbiBhbGwgY29waWVzLlxuLy9cbi8vIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTXG4vLyBXSVRIIFJFR0FSRCBUTyBUSElTIFNPRlRXQVJFIElOQ0xVRElORyBBTEwgSU1QTElFRCBXQVJSQU5USUVTIE9GXG4vLyBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1IgQkUgTElBQkxFIEZPUiBBTllcbi8vIFNQRUNJQUwsIERJUkVDVCwgSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFU1xuLy8gV0hBVFNPRVZFUiBSRVNVTFRJTkcgRlJPTSBMT1NTIE9GIFVTRSwgREFUQSBPUiBQUk9GSVRTLCBXSEVUSEVSIElOIEFOIEFDVElPTlxuLy8gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1IgT1RIRVIgVE9SVElPVVMgQUNUSU9OLCBBUklTSU5HIE9VVCBPRiBPUiBJTlxuLy8gQ09OTkVDVElPTiBXSVRIIFRIRSBVU0UgT1IgUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS5cblxuaW1wb3J0ICogYXMgbWRJdCBmcm9tICdtYXJrZG93bi1pdCdcbmltcG9ydCBUb2tlbiA9IHJlcXVpcmUoJ21hcmtkb3duLWl0L2xpYi90b2tlbicpXG5cbmNvbnN0IHNwZWNpYWxDaGFycyA9IFsnLScsICcrJywgJ34nLCAnPScsICc+J11cblxuZnVuY3Rpb24gaXNPcGVuaW5nKHN0cjogc3RyaW5nLCBwb3M6IG51bWJlcik6IFtzdHJpbmcsIHN0cmluZ10gfCBudWxsIHtcbiAgaWYgKFxuICAgIHN0cltwb3NdID09PSAneycgJiZcbiAgICBzcGVjaWFsQ2hhcnMuaW5jbHVkZXMoc3RyW3BvcyArIDFdKSAmJlxuICAgIHN0cltwb3MgKyAyXSA9PT0gc3RyW3BvcyArIDFdXG4gICkge1xuICAgIGNvbnN0IG9wID0gc3RyLnNsaWNlKHBvcyArIDEsIHBvcyArIDMpXG4gICAgY29uc3QgY2wgPSBvcFswXSA9PT0gJz4nID8gJzw8fScgOiBvcCArICd9J1xuICAgIHJldHVybiBbb3AsIGNsXVxuICB9IGVsc2Uge1xuICAgIHJldHVybiBudWxsXG4gIH1cbn1cblxuZnVuY3Rpb24gY3JpdGljSW5saW5lKFxuICBzdGF0ZTogeyBzcmM6IHN0cmluZzsgcG9zOiBudW1iZXI7IHB1c2g6ICh0b2tlbjogc3RyaW5nKSA9PiBUb2tlbiB9LFxuICBzaWxlbnQ6IGJvb2xlYW4sXG4pIHtcbiAgY29uc3QgeyBzcmMsIHBvcyB9ID0gc3RhdGVcbiAgY29uc3QgdGFncyA9IGlzT3BlbmluZyhzcmMsIHBvcylcbiAgaWYgKHRhZ3MgPT09IG51bGwpIHJldHVybiBmYWxzZVxuICBjb25zdCBbb3BlbmluZywgY2xvc2luZ10gPSB0YWdzXG4gIGNvbnN0IGVuZFBvcyA9IHNyYy5pbmRleE9mKGNsb3NpbmcsIHBvcyArIDMpXG4gIGNvbnN0IGNvbnRlbnQgPSBlbmRQb3MgPj0gMCA/IHNyYy5zbGljZShwb3MgKyAzLCBlbmRQb3MpIDogbnVsbFxuICBpZiAoY29udGVudCA9PT0gbnVsbCkgcmV0dXJuIGZhbHNlXG4gIGlmIChzaWxlbnQpIHJldHVybiB0cnVlXG4gIGNvbnN0IHRva2VuID0gc3RhdGUucHVzaCgnY3JpdGljLW1hcmt1cCcpXG4gIHRva2VuLmNvbnRlbnQgPSBjb250ZW50XG4gIHRva2VuLnRhZyA9IG9wZW5pbmdcbiAgc3RhdGUucG9zID0gZW5kUG9zICsgY2xvc2luZy5sZW5ndGhcbiAgcmV0dXJuIHRydWVcbn1cblxuZnVuY3Rpb24gY3JpdGljUmVuZGVyKHRva2VuczogVG9rZW5bXSwgaWR4OiBudW1iZXIpIHtcbiAgY29uc3QgdG9rZW4gPSB0b2tlbnNbaWR4XVxuICBjb25zdCB0YWcgPSB0b2tlbi50YWdcbiAgY29uc3QgY29udGVudCA9IHRva2VuLmNvbnRlbnRcbiAgaWYgKHRhZyA9PT0gJy0tJykge1xuICAgIHJldHVybiBgPGRlbD4ke2NvbnRlbnR9PC9kZWw+YFxuICB9IGVsc2UgaWYgKHRhZyA9PT0gJysrJykge1xuICAgIHJldHVybiBgPGlucz4ke2NvbnRlbnR9PC9pbnM+YFxuICB9IGVsc2UgaWYgKHRhZyA9PT0gJz09Jykge1xuICAgIHJldHVybiBgPG1hcms+JHtjb250ZW50fTwvbWFyaz5gXG4gIH0gZWxzZSBpZiAodGFnID09PSAnPj4nKSB7XG4gICAgcmV0dXJuIGA8c3BhbiB0YWJpbmRleD1cIi0xXCIgY2xhc3M9XCJjcml0aWMgY29tbWVudFwiPjxzcGFuPiR7Y29udGVudH08L3NwYW4+PC9zcGFuPmBcbiAgfSBlbHNlIHtcbiAgICAvLyB7fn5bdGV4dDFdfj5bdGV4dDJdfn59XG4gICAgY29uc3QgYXJyID0gY29udGVudC5zcGxpdCgnfj4nKVxuICAgIGlmIChhcnIubGVuZ3RoID09PSAyKSB7XG4gICAgICByZXR1cm4gYDxkZWw+JHthcnJbMF19PC9kZWw+PGlucz4ke2FyclsxXX08L2lucz5gXG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBgPGNvZGU+RXJyb3I6IH4+IG5vdCBmb3VuZC48L2NvZGU+YFxuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgPSBmdW5jdGlvbihtZDogbWRJdCkge1xuICBtZC5pbmxpbmUucnVsZXIuYmVmb3JlKCdzdHJpa2V0aHJvdWdoJywgJ2NyaXRpYy1tYXJrdXAnLCBjcml0aWNJbmxpbmUgYXMgYW55KVxuICBtZC5yZW5kZXJlci5ydWxlc1snY3JpdGljLW1hcmt1cCddID0gY3JpdGljUmVuZGVyXG59XG4iXX0=
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/10/31/markdown-preview-plus/lib/markdown-it-criticmarkup/index/" data-id="ck2kdakrf0016gsum5o8x0qad" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-markdown-preview-plus/lib/image-watch-helper" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/10/31/markdown-preview-plus/lib/image-watch-helper/" class="article-date">
  <time datetime="2019-10-31T09:19:10.836Z" itemprop="datePublished">2019-10-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/31/markdown-preview-plus/lib/image-watch-helper/">markdown-preview-plus/lib/image-watch-helper</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        "use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const atom_1 = require("atom");
const util_1 = require("./util");
class ImageWatcher {
    constructor(callback) {
        this.callback = callback;
        this.registry = new Map();
        this.disposed = false;
    }
    watch(image) {
        const i = this.registry.get(image);
        if (!i && util_1.isFileSync(image)) {
            const version = Date.now();
            const watcher = new atom_1.CompositeDisposable();
            const af = new atom_1.File(image);
            watcher.add(af.onDidChange(this.srcClosure(image, 'change')), af.onDidDelete(this.srcClosure(image, 'delete')), af.onDidRename(this.srcClosure(image, 'rename')));
            this.registry.set(image, {
                version,
                watcher,
            });
            return version;
        }
        else if (i) {
            return i.version;
        }
        else {
            return undefined;
        }
    }
    dispose() {
        if (this.disposed)
            return;
        this.clear();
        this.disposed = true;
    }
    clear() {
        for (const v of this.registry.values()) {
            v.watcher.dispose();
        }
        this.registry.clear();
    }
    srcClosure(src, event) {
        return () => {
            const i = this.registry.get(src);
            if (!i)
                return;
            if (event === 'change' && util_1.isFileSync(src)) {
                i.version = Date.now();
                this.refreshImages(src, i.version);
            }
            else {
                i.watcher.dispose();
                this.registry.delete(src);
                this.refreshImages(src);
            }
        };
    }
    refreshImages(src, version) {
        if (this.disposed)
            return;
        this.callback(src, version);
    }
}
exports.ImageWatcher = ImageWatcher;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW1hZ2Utd2F0Y2gtaGVscGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2ltYWdlLXdhdGNoLWhlbHBlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLCtCQUFnRDtBQUNoRCxpQ0FBbUM7QUFPbkMsTUFBYSxZQUFZO0lBSXZCLFlBQW9CLFFBQWlEO1FBQWpELGFBQVEsR0FBUixRQUFRLENBQXlDO1FBSDdELGFBQVEsR0FBRyxJQUFJLEdBQUcsRUFBNEIsQ0FBQTtRQUM5QyxhQUFRLEdBQUcsS0FBSyxDQUFBO0lBRWdELENBQUM7SUFFbEUsS0FBSyxDQUFDLEtBQWE7UUFDeEIsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDbEMsSUFBSSxDQUFDLENBQUMsSUFBSSxpQkFBVSxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQzNCLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQTtZQUMxQixNQUFNLE9BQU8sR0FBRyxJQUFJLDBCQUFtQixFQUFFLENBQUE7WUFDekMsTUFBTSxFQUFFLEdBQUcsSUFBSSxXQUFJLENBQUMsS0FBSyxDQUFDLENBQUE7WUFDMUIsT0FBTyxDQUFDLEdBQUcsQ0FDVCxFQUFFLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxDQUFDLEVBQ2hELEVBQUUsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLENBQUMsRUFDaEQsRUFBRSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUNqRCxDQUFBO1lBQ0QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFO2dCQUN2QixPQUFPO2dCQUNQLE9BQU87YUFDUixDQUFDLENBQUE7WUFDRixPQUFPLE9BQU8sQ0FBQTtTQUNmO2FBQU0sSUFBSSxDQUFDLEVBQUU7WUFDWixPQUFPLENBQUMsQ0FBQyxPQUFPLENBQUE7U0FDakI7YUFBTTtZQUNMLE9BQU8sU0FBUyxDQUFBO1NBQ2pCO0lBQ0gsQ0FBQztJQUVNLE9BQU87UUFDWixJQUFJLElBQUksQ0FBQyxRQUFRO1lBQUUsT0FBTTtRQUN6QixJQUFJLENBQUMsS0FBSyxFQUFFLENBQUE7UUFDWixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQTtJQUN0QixDQUFDO0lBRU0sS0FBSztRQUNWLEtBQUssTUFBTSxDQUFDLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsRUFBRTtZQUN0QyxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFBO1NBQ3BCO1FBQ0QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQTtJQUN2QixDQUFDO0lBRU8sVUFBVSxDQUFDLEdBQVcsRUFBRSxLQUFxQztRQUNuRSxPQUFPLEdBQUcsRUFBRTtZQUNWLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1lBQ2hDLElBQUksQ0FBQyxDQUFDO2dCQUFFLE9BQU07WUFDZCxJQUFJLEtBQUssS0FBSyxRQUFRLElBQUksaUJBQVUsQ0FBQyxHQUFHLENBQUMsRUFBRTtnQkFDekMsQ0FBQyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUE7Z0JBQ3RCLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQTthQUNuQztpQkFBTTtnQkFDTCxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFBO2dCQUNuQixJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQTtnQkFDekIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQTthQUN4QjtRQUNILENBQUMsQ0FBQTtJQUNILENBQUM7SUFFTyxhQUFhLENBQUMsR0FBVyxFQUFFLE9BQWdCO1FBQ2pELElBQUksSUFBSSxDQUFDLFFBQVE7WUFBRSxPQUFNO1FBQ3pCLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxFQUFFLE9BQU8sQ0FBQyxDQUFBO0lBQzdCLENBQUM7Q0FDRjtBQTdERCxvQ0E2REMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb3NpdGVEaXNwb3NhYmxlLCBGaWxlIH0gZnJvbSAnYXRvbSdcbmltcG9ydCB7IGlzRmlsZVN5bmMgfSBmcm9tICcuL3V0aWwnXG5cbmludGVyZmFjZSBJbWFnZVJlZ2lzdGVyUmVjIHtcbiAgdmVyc2lvbjogbnVtYmVyXG4gIHdhdGNoZXI6IENvbXBvc2l0ZURpc3Bvc2FibGVcbn1cblxuZXhwb3J0IGNsYXNzIEltYWdlV2F0Y2hlciB7XG4gIHByaXZhdGUgcmVnaXN0cnkgPSBuZXcgTWFwPHN0cmluZywgSW1hZ2VSZWdpc3RlclJlYz4oKVxuICBwcml2YXRlIGRpc3Bvc2VkID0gZmFsc2VcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNhbGxiYWNrOiAoc3JjOiBzdHJpbmcsIHZlcnNpb24/OiBudW1iZXIpID0+IHZvaWQpIHt9XG5cbiAgcHVibGljIHdhdGNoKGltYWdlOiBzdHJpbmcpOiBudW1iZXIgfCB1bmRlZmluZWQge1xuICAgIGNvbnN0IGkgPSB0aGlzLnJlZ2lzdHJ5LmdldChpbWFnZSlcbiAgICBpZiAoIWkgJiYgaXNGaWxlU3luYyhpbWFnZSkpIHtcbiAgICAgIGNvbnN0IHZlcnNpb24gPSBEYXRlLm5vdygpXG4gICAgICBjb25zdCB3YXRjaGVyID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKVxuICAgICAgY29uc3QgYWYgPSBuZXcgRmlsZShpbWFnZSlcbiAgICAgIHdhdGNoZXIuYWRkKFxuICAgICAgICBhZi5vbkRpZENoYW5nZSh0aGlzLnNyY0Nsb3N1cmUoaW1hZ2UsICdjaGFuZ2UnKSksXG4gICAgICAgIGFmLm9uRGlkRGVsZXRlKHRoaXMuc3JjQ2xvc3VyZShpbWFnZSwgJ2RlbGV0ZScpKSxcbiAgICAgICAgYWYub25EaWRSZW5hbWUodGhpcy5zcmNDbG9zdXJlKGltYWdlLCAncmVuYW1lJykpLFxuICAgICAgKVxuICAgICAgdGhpcy5yZWdpc3RyeS5zZXQoaW1hZ2UsIHtcbiAgICAgICAgdmVyc2lvbixcbiAgICAgICAgd2F0Y2hlcixcbiAgICAgIH0pXG4gICAgICByZXR1cm4gdmVyc2lvblxuICAgIH0gZWxzZSBpZiAoaSkge1xuICAgICAgcmV0dXJuIGkudmVyc2lvblxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkXG4gICAgfVxuICB9XG5cbiAgcHVibGljIGRpc3Bvc2UoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuZGlzcG9zZWQpIHJldHVyblxuICAgIHRoaXMuY2xlYXIoKVxuICAgIHRoaXMuZGlzcG9zZWQgPSB0cnVlXG4gIH1cblxuICBwdWJsaWMgY2xlYXIoKTogdm9pZCB7XG4gICAgZm9yIChjb25zdCB2IG9mIHRoaXMucmVnaXN0cnkudmFsdWVzKCkpIHtcbiAgICAgIHYud2F0Y2hlci5kaXNwb3NlKClcbiAgICB9XG4gICAgdGhpcy5yZWdpc3RyeS5jbGVhcigpXG4gIH1cblxuICBwcml2YXRlIHNyY0Nsb3N1cmUoc3JjOiBzdHJpbmcsIGV2ZW50OiAnY2hhbmdlJyB8ICdkZWxldGUnIHwgJ3JlbmFtZScpIHtcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgY29uc3QgaSA9IHRoaXMucmVnaXN0cnkuZ2V0KHNyYylcbiAgICAgIGlmICghaSkgcmV0dXJuXG4gICAgICBpZiAoZXZlbnQgPT09ICdjaGFuZ2UnICYmIGlzRmlsZVN5bmMoc3JjKSkge1xuICAgICAgICBpLnZlcnNpb24gPSBEYXRlLm5vdygpXG4gICAgICAgIHRoaXMucmVmcmVzaEltYWdlcyhzcmMsIGkudmVyc2lvbilcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGkud2F0Y2hlci5kaXNwb3NlKClcbiAgICAgICAgdGhpcy5yZWdpc3RyeS5kZWxldGUoc3JjKVxuICAgICAgICB0aGlzLnJlZnJlc2hJbWFnZXMoc3JjKVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcmVmcmVzaEltYWdlcyhzcmM6IHN0cmluZywgdmVyc2lvbj86IG51bWJlcikge1xuICAgIGlmICh0aGlzLmRpc3Bvc2VkKSByZXR1cm5cbiAgICB0aGlzLmNhbGxiYWNrKHNyYywgdmVyc2lvbilcbiAgfVxufVxuIl19
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/10/31/markdown-preview-plus/lib/image-watch-helper/" data-id="ck2kdakql000jgsum0vtihl1j" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-markdown-preview-plus/lib/macros-util" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/10/31/markdown-preview-plus/lib/macros-util/" class="article-date">
  <time datetime="2019-10-31T09:19:10.836Z" itemprop="datePublished">2019-10-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/31/markdown-preview-plus/lib/macros-util/">markdown-preview-plus/lib/macros-util</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        "use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const path = require("path");
const CSON = require("season");
const fs = require("fs");
const util_1 = require("./util");
function getUserMacrosPath(atomHome) {
    const userMacrosPath = CSON.resolve(path.join(atomHome, 'markdown-preview-plus'));
    return userMacrosPath != null
        ? userMacrosPath
        : path.join(atomHome, 'markdown-preview-plus.cson');
}
function loadMacrosFile(filePath) {
    if (!CSON.isObjectPath(filePath))
        return {};
    const macros = CSON.readFileSync(filePath, function (error, object) {
        if (error !== undefined) {
            console.warn(`Error reading Latex Macros file '${filePath}': ${error.stack !== undefined ? error.stack : error}`);
            console.error(`Failed to load Latex Macros from '${filePath}'`, {
                detail: error.message,
                dismissable: true,
            });
        }
        return object;
    });
    return checkMacros(macros || {});
}
function loadUserMacros(atomHome = atom.getConfigDirPath()) {
    const userMacrosPath = getUserMacrosPath(atomHome);
    if (util_1.isFileSync(userMacrosPath)) {
        return loadMacrosFile(userMacrosPath);
    }
    else {
        console.debug('Creating markdown-preview-plus.cson, this is a one-time operation.');
        createMacrosTemplate(userMacrosPath);
        return loadMacrosFile(userMacrosPath);
    }
}
exports.loadUserMacros = loadUserMacros;
function createMacrosTemplate(filePath) {
    const templatePath = path.join(__dirname, '../assets/macros-template.cson');
    const templateFile = fs.readFileSync(templatePath, 'utf8');
    fs.writeFileSync(filePath, templateFile);
}
function checkMacros(macrosObject) {
    const namePattern = /^[^a-zA-Z\d\s]$|^[a-zA-Z]*$/;
    const result = {};
    for (const name of Object.keys(macrosObject)) {
        const value = macrosObject[name];
        if (name.match(namePattern) && valueMatchesPattern(value)) {
            result[name] = value;
        }
        else {
            atom.notifications.addWarning(`Markdown-Preview-Plus failed to load LaTeX macro named '${name}'.` +
                ` Please see the [LaTeX guide](https://github.com/atom-community/markdown-preview-plus/blob/master/docs/math.md#macro-names)`);
        }
    }
    return result;
}
function valueMatchesPattern(value) {
    if (Array.isArray(value)) {
        const macroDefinition = value[0];
        const numberOfArgs = value[1];
        if (typeof numberOfArgs === 'number') {
            return numberOfArgs % 1 === 0 && typeof macroDefinition === 'string';
        }
        else {
            return false;
        }
    }
    else if (typeof value === 'string') {
        return true;
    }
    else {
        return false;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFjcm9zLXV0aWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvbWFjcm9zLXV0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw2QkFBNkI7QUFDN0IsK0JBQStCO0FBQy9CLHlCQUF5QjtBQUN6QixpQ0FBbUM7QUFFbkMsU0FBUyxpQkFBaUIsQ0FBQyxRQUFnQjtJQUN6QyxNQUFNLGNBQWMsR0FBOEIsSUFBSSxDQUFDLE9BQU8sQ0FDNUQsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsdUJBQXVCLENBQUMsQ0FDN0MsQ0FBQTtJQUNELE9BQU8sY0FBYyxJQUFJLElBQUk7UUFDM0IsQ0FBQyxDQUFDLGNBQWM7UUFDaEIsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLDRCQUE0QixDQUFDLENBQUE7QUFDdkQsQ0FBQztBQUVELFNBQVMsY0FBYyxDQUFDLFFBQWdCO0lBQ3RDLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQztRQUFFLE9BQU8sRUFBRSxDQUFBO0lBRTNDLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxFQUFFLFVBQ3pDLEtBQWEsRUFDYixNQUFlO1FBRWYsSUFBSSxLQUFLLEtBQUssU0FBUyxFQUFFO1lBQ3ZCLE9BQU8sQ0FBQyxJQUFJLENBQ1Ysb0NBQW9DLFFBQVEsTUFDMUMsS0FBSyxDQUFDLEtBQUssS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQzVDLEVBQUUsQ0FDSCxDQUFBO1lBQ0QsT0FBTyxDQUFDLEtBQUssQ0FBQyxxQ0FBcUMsUUFBUSxHQUFHLEVBQUU7Z0JBQzlELE1BQU0sRUFBRSxLQUFLLENBQUMsT0FBTztnQkFDckIsV0FBVyxFQUFFLElBQUk7YUFDbEIsQ0FBQyxDQUFBO1NBQ0g7UUFDRCxPQUFPLE1BQU0sQ0FBQTtJQUNmLENBQUMsQ0FBQyxDQUFBO0lBQ0YsT0FBTyxXQUFXLENBQUMsTUFBTSxJQUFJLEVBQUUsQ0FBQyxDQUFBO0FBQ2xDLENBQUM7QUFFRCxTQUFnQixjQUFjLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsRUFBRTtJQUMvRCxNQUFNLGNBQWMsR0FBRyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsQ0FBQTtJQUNsRCxJQUFJLGlCQUFVLENBQUMsY0FBYyxDQUFDLEVBQUU7UUFDOUIsT0FBTyxjQUFjLENBQUMsY0FBYyxDQUFDLENBQUE7S0FDdEM7U0FBTTtRQUNMLE9BQU8sQ0FBQyxLQUFLLENBQ1gsb0VBQW9FLENBQ3JFLENBQUE7UUFDRCxvQkFBb0IsQ0FBQyxjQUFjLENBQUMsQ0FBQTtRQUNwQyxPQUFPLGNBQWMsQ0FBQyxjQUFjLENBQUMsQ0FBQTtLQUN0QztBQUNILENBQUM7QUFYRCx3Q0FXQztBQUVELFNBQVMsb0JBQW9CLENBQUMsUUFBZ0I7SUFDNUMsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsZ0NBQWdDLENBQUMsQ0FBQTtJQUMzRSxNQUFNLFlBQVksR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDLFlBQVksRUFBRSxNQUFNLENBQUMsQ0FBQTtJQUMxRCxFQUFFLENBQUMsYUFBYSxDQUFDLFFBQVEsRUFBRSxZQUFZLENBQUMsQ0FBQTtBQUMxQyxDQUFDO0FBRUQsU0FBUyxXQUFXLENBQUMsWUFBb0I7SUFDdkMsTUFBTSxXQUFXLEdBQUcsNkJBQTZCLENBQUE7SUFDakQsTUFBTSxNQUFNLEdBQUcsRUFBRSxDQUFBO0lBQ2pCLEtBQUssTUFBTSxJQUFJLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsRUFBRTtRQUM1QyxNQUFNLEtBQUssR0FBRyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUE7UUFDaEMsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxJQUFJLG1CQUFtQixDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQ3pELE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxLQUFLLENBQUE7U0FDckI7YUFBTTtZQUNMLElBQUksQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUMzQiwyREFBMkQsSUFBSSxJQUFJO2dCQUNqRSw2SEFBNkgsQ0FDaEksQ0FBQTtTQUNGO0tBQ0Y7SUFDRCxPQUFPLE1BQU0sQ0FBQTtBQUNmLENBQUM7QUFFRCxTQUFTLG1CQUFtQixDQUFDLEtBQVU7SUFFckMsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFO1FBQ3hCLE1BQU0sZUFBZSxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQTtRQUNoQyxNQUFNLFlBQVksR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDN0IsSUFBSSxPQUFPLFlBQVksS0FBSyxRQUFRLEVBQUU7WUFDcEMsT0FBTyxZQUFZLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxPQUFPLGVBQWUsS0FBSyxRQUFRLENBQUE7U0FDckU7YUFBTTtZQUNMLE9BQU8sS0FBSyxDQUFBO1NBQ2I7S0FDRjtTQUFNLElBQUksT0FBTyxLQUFLLEtBQUssUUFBUSxFQUFFO1FBQ3BDLE9BQU8sSUFBSSxDQUFBO0tBQ1o7U0FBTTtRQUNMLE9BQU8sS0FBSyxDQUFBO0tBQ2I7QUFDSCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHBhdGggPSByZXF1aXJlKCdwYXRoJylcbmltcG9ydCBDU09OID0gcmVxdWlyZSgnc2Vhc29uJylcbmltcG9ydCBmcyA9IHJlcXVpcmUoJ2ZzJylcbmltcG9ydCB7IGlzRmlsZVN5bmMgfSBmcm9tICcuL3V0aWwnXG5cbmZ1bmN0aW9uIGdldFVzZXJNYWNyb3NQYXRoKGF0b21Ib21lOiBzdHJpbmcpOiBzdHJpbmcge1xuICBjb25zdCB1c2VyTWFjcm9zUGF0aDogc3RyaW5nIHwgdW5kZWZpbmVkIHwgbnVsbCA9IENTT04ucmVzb2x2ZShcbiAgICBwYXRoLmpvaW4oYXRvbUhvbWUsICdtYXJrZG93bi1wcmV2aWV3LXBsdXMnKSxcbiAgKVxuICByZXR1cm4gdXNlck1hY3Jvc1BhdGggIT0gbnVsbFxuICAgID8gdXNlck1hY3Jvc1BhdGhcbiAgICA6IHBhdGguam9pbihhdG9tSG9tZSwgJ21hcmtkb3duLXByZXZpZXctcGx1cy5jc29uJylcbn1cblxuZnVuY3Rpb24gbG9hZE1hY3Jvc0ZpbGUoZmlsZVBhdGg6IHN0cmluZyk6IG9iamVjdCB7XG4gIGlmICghQ1NPTi5pc09iamVjdFBhdGgoZmlsZVBhdGgpKSByZXR1cm4ge31cblxuICBjb25zdCBtYWNyb3MgPSBDU09OLnJlYWRGaWxlU3luYyhmaWxlUGF0aCwgZnVuY3Rpb24oXG4gICAgZXJyb3I/OiBFcnJvcixcbiAgICBvYmplY3Q/OiBvYmplY3QsXG4gICkge1xuICAgIGlmIChlcnJvciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgIGBFcnJvciByZWFkaW5nIExhdGV4IE1hY3JvcyBmaWxlICcke2ZpbGVQYXRofSc6ICR7XG4gICAgICAgICAgZXJyb3Iuc3RhY2sgIT09IHVuZGVmaW5lZCA/IGVycm9yLnN0YWNrIDogZXJyb3JcbiAgICAgICAgfWAsXG4gICAgICApXG4gICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gbG9hZCBMYXRleCBNYWNyb3MgZnJvbSAnJHtmaWxlUGF0aH0nYCwge1xuICAgICAgICBkZXRhaWw6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgIGRpc21pc3NhYmxlOiB0cnVlLFxuICAgICAgfSlcbiAgICB9XG4gICAgcmV0dXJuIG9iamVjdFxuICB9KVxuICByZXR1cm4gY2hlY2tNYWNyb3MobWFjcm9zIHx8IHt9KVxufVxuXG5leHBvcnQgZnVuY3Rpb24gbG9hZFVzZXJNYWNyb3MoYXRvbUhvbWUgPSBhdG9tLmdldENvbmZpZ0RpclBhdGgoKSkge1xuICBjb25zdCB1c2VyTWFjcm9zUGF0aCA9IGdldFVzZXJNYWNyb3NQYXRoKGF0b21Ib21lKVxuICBpZiAoaXNGaWxlU3luYyh1c2VyTWFjcm9zUGF0aCkpIHtcbiAgICByZXR1cm4gbG9hZE1hY3Jvc0ZpbGUodXNlck1hY3Jvc1BhdGgpXG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS5kZWJ1ZyhcbiAgICAgICdDcmVhdGluZyBtYXJrZG93bi1wcmV2aWV3LXBsdXMuY3NvbiwgdGhpcyBpcyBhIG9uZS10aW1lIG9wZXJhdGlvbi4nLFxuICAgIClcbiAgICBjcmVhdGVNYWNyb3NUZW1wbGF0ZSh1c2VyTWFjcm9zUGF0aClcbiAgICByZXR1cm4gbG9hZE1hY3Jvc0ZpbGUodXNlck1hY3Jvc1BhdGgpXG4gIH1cbn1cblxuZnVuY3Rpb24gY3JlYXRlTWFjcm9zVGVtcGxhdGUoZmlsZVBhdGg6IHN0cmluZykge1xuICBjb25zdCB0ZW1wbGF0ZVBhdGggPSBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4vYXNzZXRzL21hY3Jvcy10ZW1wbGF0ZS5jc29uJylcbiAgY29uc3QgdGVtcGxhdGVGaWxlID0gZnMucmVhZEZpbGVTeW5jKHRlbXBsYXRlUGF0aCwgJ3V0ZjgnKVxuICBmcy53cml0ZUZpbGVTeW5jKGZpbGVQYXRoLCB0ZW1wbGF0ZUZpbGUpXG59XG5cbmZ1bmN0aW9uIGNoZWNrTWFjcm9zKG1hY3Jvc09iamVjdDogb2JqZWN0KSB7XG4gIGNvbnN0IG5hbWVQYXR0ZXJuID0gL15bXmEtekEtWlxcZFxcc10kfF5bYS16QS1aXSokLyAvLyBsZXR0ZXJzLCBidXQgbm8gbnVtZXJhbHMuXG4gIGNvbnN0IHJlc3VsdCA9IHt9XG4gIGZvciAoY29uc3QgbmFtZSBvZiBPYmplY3Qua2V5cyhtYWNyb3NPYmplY3QpKSB7XG4gICAgY29uc3QgdmFsdWUgPSBtYWNyb3NPYmplY3RbbmFtZV1cbiAgICBpZiAobmFtZS5tYXRjaChuYW1lUGF0dGVybikgJiYgdmFsdWVNYXRjaGVzUGF0dGVybih2YWx1ZSkpIHtcbiAgICAgIHJlc3VsdFtuYW1lXSA9IHZhbHVlXG4gICAgfSBlbHNlIHtcbiAgICAgIGF0b20ubm90aWZpY2F0aW9ucy5hZGRXYXJuaW5nKFxuICAgICAgICBgTWFya2Rvd24tUHJldmlldy1QbHVzIGZhaWxlZCB0byBsb2FkIExhVGVYIG1hY3JvIG5hbWVkICcke25hbWV9Jy5gICtcbiAgICAgICAgICBgIFBsZWFzZSBzZWUgdGhlIFtMYVRlWCBndWlkZV0oaHR0cHM6Ly9naXRodWIuY29tL2F0b20tY29tbXVuaXR5L21hcmtkb3duLXByZXZpZXctcGx1cy9ibG9iL21hc3Rlci9kb2NzL21hdGgubWQjbWFjcm8tbmFtZXMpYCxcbiAgICAgIClcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdFxufVxuXG5mdW5jdGlvbiB2YWx1ZU1hdGNoZXNQYXR0ZXJuKHZhbHVlOiBhbnkpIHtcbiAgLy8gRGlmZmVyZW50IGNoZWNrIGJhc2VkIG9uIHdoZXRoZXIgdmFsdWUgaXMgc3RyaW5nIG9yIGFycmF5XG4gIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgIGNvbnN0IG1hY3JvRGVmaW5pdGlvbiA9IHZhbHVlWzBdXG4gICAgY29uc3QgbnVtYmVyT2ZBcmdzID0gdmFsdWVbMV1cbiAgICBpZiAodHlwZW9mIG51bWJlck9mQXJncyA9PT0gJ251bWJlcicpIHtcbiAgICAgIHJldHVybiBudW1iZXJPZkFyZ3MgJSAxID09PSAwICYmIHR5cGVvZiBtYWNyb0RlZmluaXRpb24gPT09ICdzdHJpbmcnXG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIHRydWVcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxufVxuIl19
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/10/31/markdown-preview-plus/lib/macros-util/" data-id="ck2kdakqm000kgsumdqa0d8ww" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-markdown-preview-plus/lib/main" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/10/31/markdown-preview-plus/lib/main/" class="article-date">
  <time datetime="2019-10-31T09:19:10.836Z" itemprop="datePublished">2019-10-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/31/markdown-preview-plus/lib/main/">markdown-preview-plus/lib/main</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        "use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const url = require("url");
const markdown_preview_view_1 = require("./markdown-preview-view");
const atom_1 = require("atom");
const util = require("./util");
const placeholder_view_1 = require("./placeholder-view");
const migrate_config_1 = require("./migrate-config");
const markdown_preview_view_editor_remote_1 = require("./markdown-preview-view/markdown-preview-view-editor-remote");
var config_1 = require("./config");
exports.config = config_1.config;
let disposables;
async function activate() {
    if (migrate_config_1.migrateConfig()) {
        atom.notifications.addInfo('Markdown-Preivew-Plus has updated your config to a new format. ' +
            'Please check if everything is in order. ' +
            'This message will not be shown again.', { dismissable: true });
    }
    if (atom.packages.isPackageActive('markdown-preview')) {
        await atom.packages.deactivatePackage('markdown-preview');
    }
    if (!atom.packages.isPackageDisabled('markdown-preview')) {
        atom.packages.disablePackage('markdown-preview');
        atom.notifications.addInfo('Markdown-preview-plus has disabled markdown-preview package.', { dismissable: true });
    }
    disposables = new atom_1.CompositeDisposable();
    disposables.add(atom.commands.add('.markdown-preview-plus', {
        'markdown-preview-plus:toggle': close,
    }), atom.commands.add('atom-workspace', {
        'markdown-preview-plus:select-syntax-theme': async () => {
            try {
                const { selectListView } = await Promise.resolve().then(() => require('./select-list-view'));
                const themeNames = atom.themes.getLoadedThemeNames();
                if (themeNames === undefined)
                    return;
                const theme = await selectListView(themeNames.filter((x) => x.match(/-syntax$/)));
                if (theme === undefined)
                    return;
                atom.config.set('markdown-preview-plus.syntaxThemeName', theme);
            }
            catch (e) {
                const err = e;
                atom.notifications.addFatalError(err.name, {
                    detail: err.message,
                    stack: err.stack,
                });
            }
        },
    }), atom.commands.add('atom-text-editor', {
        'markdown-preview-plus:toggle-render-latex': (e) => {
            const editor = e.currentTarget.getModel();
            const view = markdown_preview_view_1.MarkdownPreviewViewEditor.viewForEditor(editor);
            if (view)
                view.toggleRenderLatex();
        },
    }), atom.commands.add('.markdown-preview-plus', {
        'markdown-preview-plus:toggle-render-latex': (e) => {
            const view = markdown_preview_view_1.MarkdownPreviewView.viewForElement(e.currentTarget);
            if (view)
                view.toggleRenderLatex();
        },
    }), atom.workspace.addOpener(opener), atom.config.observe('markdown-preview-plus.grammars', configObserver(registerGrammars)), atom.config.observe('markdown-preview-plus.extensions', configObserver(registerExtensions)));
}
exports.activate = activate;
function deactivate() {
    disposables && disposables.dispose();
}
exports.deactivate = deactivate;
function createMarkdownPreviewView(state) {
    if (state.editorId !== undefined) {
        return new placeholder_view_1.PlaceholderView(state.editorId);
    }
    else if (state.filePath && util.isFileSync(state.filePath)) {
        return new markdown_preview_view_1.MarkdownPreviewViewFile(state.filePath);
    }
    return undefined;
}
exports.createMarkdownPreviewView = createMarkdownPreviewView;
async function close(event) {
    const item = markdown_preview_view_1.MarkdownPreviewView.viewForElement(event.currentTarget);
    if (!item)
        return;
    const pane = atom.workspace.paneForItem(item);
    if (!pane)
        return;
    await pane.destroyItem(item);
}
async function toggle(editor) {
    if (removePreviewForEditor(editor))
        return undefined;
    else
        return addPreviewForEditor(editor);
}
function removePreviewForEditor(editor) {
    const item = markdown_preview_view_1.MarkdownPreviewViewEditor.viewForEditor(editor);
    if (!item)
        return false;
    const previewPane = atom.workspace.paneForItem(item);
    if (!previewPane)
        return false;
    if (item !== previewPane.getActiveItem()) {
        previewPane.activateItem(item);
        return false;
    }
    util.handlePromise(previewPane.destroyItem(item));
    return true;
}
async function addPreviewForEditor(editor) {
    const previousActivePane = atom.workspace.getActivePane();
    const options = { searchAllPanes: true };
    const splitConfig = util.atomConfig().previewConfig.previewSplitPaneDir;
    if (splitConfig !== 'none') {
        options.split = splitConfig;
    }
    const res = await atom.workspace.open(markdown_preview_view_1.MarkdownPreviewViewEditor.create(editor), options);
    previousActivePane.activate();
    return res;
}
async function previewFile({ currentTarget }) {
    const filePath = currentTarget.dataset.path;
    if (!filePath) {
        return;
    }
    for (const editor of atom.workspace.getTextEditors()) {
        if (editor.getPath() === filePath) {
            await addPreviewForEditor(editor);
            return;
        }
    }
    await atom.workspace.open(`markdown-preview-plus://file/${encodeURI(filePath)}`, {
        searchAllPanes: true,
    });
}
async function copyHtmlInternal(editor) {
    const renderLaTeX = util.atomConfig().mathConfig.enableLatexRenderingByDefault;
    const text = editor.getSelectedText() || editor.getText();
    await util.copyHtml(text, editor.getPath(), renderLaTeX);
}
function configObserver(f) {
    let configDisposables;
    return function (value) {
        if (!disposables)
            return;
        if (configDisposables) {
            configDisposables.dispose();
            disposables.remove(configDisposables);
        }
        configDisposables = new atom_1.CompositeDisposable();
        const contextMenu = {};
        f(value, configDisposables, contextMenu);
        configDisposables.add(atom.contextMenu.add(contextMenu));
        disposables.add(configDisposables);
    };
}
function registerExtensions(extensions, disp, cm) {
    for (const ext of extensions) {
        const selector = `.tree-view .file .name[data-name$=".${ext}"]`;
        disp.add(atom.commands.add(selector, 'markdown-preview-plus:preview-file', previewFile));
        cm[selector] = [
            {
                label: 'Markdown Preview',
                command: 'markdown-preview-plus:preview-file',
            },
        ];
    }
}
function registerGrammars(grammars, disp, cm) {
    for (const gr of grammars) {
        const grs = gr.replace(/\./g, ' ');
        const selector = `atom-text-editor[data-grammar="${grs}"]`;
        disp.add(atom.commands.add(selector, {
            'markdown-preview-plus:toggle': (e) => {
                util.handlePromise(toggle(e.currentTarget.getModel()));
            },
            'markdown-preview-plus:copy-html': (e) => {
                util.handlePromise(copyHtmlInternal(e.currentTarget.getModel()));
            },
        }));
        cm[selector] = [
            {
                label: 'Sync Preview',
                command: 'markdown-preview-plus:sync-preview',
            },
            {
                label: 'Copy Markdown as HTML',
                command: 'markdown-preview-plus:copy-html',
            },
        ];
    }
}
function opener(uriToOpen) {
    try {
        var uri = url.parse(uriToOpen);
    }
    catch (e) {
        console.error(e, uriToOpen);
        return undefined;
    }
    if (uri.protocol !== 'markdown-preview-plus:')
        return undefined;
    if (!uri.pathname)
        return undefined;
    try {
        var pathname = decodeURI(uri.pathname);
    }
    catch (e) {
        console.error(e);
        return undefined;
    }
    if (uri.hostname === 'file') {
        return new markdown_preview_view_1.MarkdownPreviewViewFile(pathname.slice(1));
    }
    else if (uri.hostname === 'editor') {
        const editorId = parseInt(pathname.slice(1), 10);
        const editor = atom.workspace
            .getTextEditors()
            .find((ed) => ed.id === editorId);
        if (editor === undefined) {
            atom.notifications.addWarning('Markdown-preview-plus: Tried to open preview ' +
                `for editor with id ${editorId}, which does not exist`);
            return undefined;
        }
        return markdown_preview_view_1.MarkdownPreviewViewEditor.create(editor);
    }
    else if (uri.hostname === 'remote-editor') {
        const [windowId, editorId] = pathname
            .slice(1)
            .split('/')
            .map((x) => parseInt(x, 10));
        return new markdown_preview_view_editor_remote_1.MarkdownPreviewViewEditorRemote(windowId, editorId);
    }
    else {
        throw new Error(`Tried to open markdown-preview-plus with uri ${uriToOpen}. This is not supported. Please report this error.`);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9tYWluLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsMkJBQTJCO0FBQzNCLG1FQUtnQztBQUVoQywrQkFNYTtBQUNiLCtCQUE4QjtBQUM5Qix5REFBb0Q7QUFDcEQscURBQWdEO0FBQ2hELHFIQUE2RztBQUU3RyxtQ0FBaUM7QUFBeEIsMEJBQUEsTUFBTSxDQUFBO0FBRWYsSUFBSSxXQUE0QyxDQUFBO0FBRXpDLEtBQUssVUFBVSxRQUFRO0lBQzVCLElBQUksOEJBQWEsRUFBRSxFQUFFO1FBQ25CLElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUN4QixpRUFBaUU7WUFDL0QsMENBQTBDO1lBQzFDLHVDQUF1QyxFQUN6QyxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUUsQ0FDdEIsQ0FBQTtLQUNGO0lBQ0QsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLGVBQWUsQ0FBQyxrQkFBa0IsQ0FBQyxFQUFFO1FBQ3JELE1BQU0sSUFBSSxDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFBO0tBQzFEO0lBQ0QsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsaUJBQWlCLENBQUMsa0JBQWtCLENBQUMsRUFBRTtRQUN4RCxJQUFJLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFBO1FBQ2hELElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUN4Qiw4REFBOEQsRUFDOUQsRUFBRSxXQUFXLEVBQUUsSUFBSSxFQUFFLENBQ3RCLENBQUE7S0FDRjtJQUNELFdBQVcsR0FBRyxJQUFJLDBCQUFtQixFQUFFLENBQUE7SUFDdkMsV0FBVyxDQUFDLEdBQUcsQ0FDYixJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyx3QkFBd0IsRUFBRTtRQUMxQyw4QkFBOEIsRUFBRSxLQUFLO0tBQ3RDLENBQUMsRUFDRixJQUFJLENBQUMsUUFBUSxD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QyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUE7S0FDaEQ7U0FBTSxJQUFJLEdBQUcsQ0FBQyxRQUFRLEtBQUssZUFBZSxFQUFFO1FBQzNDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDLEdBQUcsUUFBUTthQUNsQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2FBQ1IsS0FBSyxDQUFDLEdBQUcsQ0FBQzthQUNWLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFBO1FBQzlCLE9BQU8sSUFBSSxxRUFBK0IsQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUE7S0FDL0Q7U0FBTTtRQUNMLE1BQU0sSUFBSSxLQUFLLENBQ2IsZ0RBQWdELFNBQVMsb0RBQW9ELENBQzlHLENBQUE7S0FDRjtBQUNILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdXJsID0gcmVxdWlyZSgndXJsJylcbmltcG9ydCB7XG4gIFNlcmlhbGl6ZWRNUFYsXG4gIE1hcmtkb3duUHJldmlld1ZpZXdGaWxlLFxuICBNYXJrZG93blByZXZpZXdWaWV3RWRpdG9yLFxuICBNYXJrZG93blByZXZpZXdWaWV3LFxufSBmcm9tICcuL21hcmtkb3duLXByZXZpZXctdmlldydcbi8vIGltcG9ydCBtYXRoamF4SGVscGVyID0gcmVxdWlyZSgnLi9tYXRoamF4LWhlbHBlcicpXG5pbXBvcnQge1xuICBUZXh0RWRpdG9yLFxuICBXb3Jrc3BhY2VPcGVuT3B0aW9ucyxcbiAgQ29tbWFuZEV2ZW50LFxuICBDb21wb3NpdGVEaXNwb3NhYmxlLFxuICBDb250ZXh0TWVudU9wdGlvbnMsXG59IGZyb20gJ2F0b20nXG5pbXBvcnQgKiBhcyB1dGlsIGZyb20gJy4vdXRpbCdcbmltcG9ydCB7IFBsYWNlaG9sZGVyVmlldyB9IGZyb20gJy4vcGxhY2Vob2xkZXItdmlldydcbmltcG9ydCB7IG1pZ3JhdGVDb25maWcgfSBmcm9tICcuL21pZ3JhdGUtY29uZmlnJ1xuaW1wb3J0IHsgTWFya2Rvd25QcmV2aWV3Vmlld0VkaXRvclJlbW90ZSB9IGZyb20gJy4vbWFya2Rvd24tcHJldmlldy12aWV3L21hcmtkb3duLXByZXZpZXctdmlldy1lZGl0b3ItcmVtb3RlJ1xuXG5leHBvcnQgeyBjb25maWcgfSBmcm9tICcuL2NvbmZpZydcblxubGV0IGRpc3Bvc2FibGVzOiBDb21wb3NpdGVEaXNwb3NhYmxlIHwgdW5kZWZpbmVkXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcbiAgaWYgKG1pZ3JhdGVDb25maWcoKSkge1xuICAgIGF0b20ubm90aWZpY2F0aW9ucy5hZGRJbmZvKFxuICAgICAgJ01hcmtkb3duLVByZWl2ZXctUGx1cyBoYXMgdXBkYXRlZCB5b3VyIGNvbmZpZyB0byBhIG5ldyBmb3JtYXQuICcgK1xuICAgICAgICAnUGxlYXNlIGNoZWNrIGlmIGV2ZXJ5dGhpbmcgaXMgaW4gb3JkZXIuICcgK1xuICAgICAgICAnVGhpcyBtZXNzYWdlIHdpbGwgbm90IGJlIHNob3duIGFnYWluLicsXG4gICAgICB7IGRpc21pc3NhYmxlOiB0cnVlIH0sXG4gICAgKVxuICB9XG4gIGlmIChhdG9tLnBhY2thZ2VzLmlzUGFja2FnZUFjdGl2ZSgnbWFya2Rvd24tcHJldmlldycpKSB7XG4gICAgYXdhaXQgYXRvbS5wYWNrYWdlcy5kZWFjdGl2YXRlUGFja2FnZSgnbWFya2Rvd24tcHJldmlldycpXG4gIH1cbiAgaWYgKCFhdG9tLnBhY2thZ2VzLmlzUGFja2FnZURpc2FibGVkKCdtYXJrZG93bi1wcmV2aWV3JykpIHtcbiAgICBhdG9tLnBhY2thZ2VzLmRpc2FibGVQYWNrYWdlKCdtYXJrZG93bi1wcmV2aWV3JylcbiAgICBhdG9tLm5vdGlmaWNhdGlvbnMuYWRkSW5mbyhcbiAgICAgICdNYXJrZG93bi1wcmV2aWV3LXBsdXMgaGFzIGRpc2FibGVkIG1hcmtkb3duLXByZXZpZXcgcGFja2FnZS4nLFxuICAgICAgeyBkaXNtaXNzYWJsZTogdHJ1ZSB9LFxuICAgIClcbiAgfVxuICBkaXNwb3NhYmxlcyA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKClcbiAgZGlzcG9zYWJsZXMuYWRkKFxuICAgIGF0b20uY29tbWFuZHMuYWRkKCcubWFya2Rvd24tcHJldmlldy1wbHVzJywge1xuICAgICAgJ21hcmtkb3duLXByZXZpZXctcGx1czp0b2dnbGUnOiBjbG9zZSxcbiAgICB9KSxcbiAgICBhdG9tLmNvbW1hbmRzLmFkZCgnYXRvbS13b3Jrc3BhY2UnLCB7XG4gICAgICAnbWFya2Rvd24tcHJldmlldy1wbHVzOnNlbGVjdC1zeW50YXgtdGhlbWUnOiBhc3luYyAoKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgeyBzZWxlY3RMaXN0VmlldyB9ID0gYXdhaXQgaW1wb3J0KCcuL3NlbGVjdC1saXN0LXZpZXcnKVxuICAgICAgICAgIGNvbnN0IHRoZW1lTmFtZXMgPSBhdG9tLnRoZW1lcy5nZXRMb2FkZWRUaGVtZU5hbWVzKClcbiAgICAgICAgICBpZiAodGhlbWVOYW1lcyA9PT0gdW5kZWZpbmVkKSByZXR1cm5cbiAgICAgICAgICBjb25zdCB0aGVtZSA9IGF3YWl0IHNlbGVjdExpc3RWaWV3KFxuICAgICAgICAgICAgdGhlbWVOYW1lcy5maWx0ZXIoKHgpID0+IHgubWF0Y2goLy1zeW50YXgkLykpLFxuICAgICAgICAgIClcbiAgICAgICAgICBpZiAodGhlbWUgPT09IHVuZGVmaW5lZCkgcmV0dXJuXG4gICAgICAgICAgYXRvbS5jb25maWcuc2V0KCdtYXJrZG93bi1wcmV2aWV3LXBsdXMuc3ludGF4VGhlbWVOYW1lJywgdGhlbWUpXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICBjb25zdCBlcnIgPSBlIGFzIEVycm9yXG4gICAgICAgICAgYXRvbS5ub3RpZmljYXRpb25zLmFkZEZhdGFsRXJyb3IoZXJyLm5hbWUsIHtcbiAgICAgICAgICAgIGRldGFpbDogZXJyLm1lc3NhZ2UsXG4gICAgICAgICAgICBzdGFjazogZXJyLnN0YWNrLFxuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgfSksXG4gICAgYXRvbS5jb21tYW5kcy5hZGQoJ2F0b20tdGV4dC1lZGl0b3InLCB7XG4gICAgICAnbWFya2Rvd24tcHJldmlldy1wbHVzOnRvZ2dsZS1yZW5kZXItbGF0ZXgnOiAoZSkgPT4ge1xuICAgICAgICBjb25zdCBlZGl0b3IgPSBlLmN1cnJlbnRUYXJnZXQuZ2V0TW9kZWwoKVxuICAgICAgICBjb25zdCB2aWV3ID0gTWFya2Rvd25QcmV2aWV3Vmlld0VkaXRvci52aWV3Rm9yRWRpdG9yKGVkaXRvcilcbiAgICAgICAgaWYgKHZpZXcpIHZpZXcudG9nZ2xlUmVuZGVyTGF0ZXgoKVxuICAgICAgfSxcbiAgICB9KSxcbiAgICBhdG9tLmNvbW1hbmRzLmFkZCgnLm1hcmtkb3duLXByZXZpZXctcGx1cycsIHtcbiAgICAgICdtYXJrZG93bi1wcmV2aWV3LXBsdXM6dG9nZ2xlLXJlbmRlci1sYXRleCc6IChlKSA9PiB7XG4gICAgICAgIGNvbnN0IHZpZXcgPSBNYXJrZG93blByZXZpZXdWaWV3LnZpZXdGb3JFbGVtZW50KGUuY3VycmVudFRhcmdldClcbiAgICAgICAgaWYgKHZpZXcpIHZpZXcudG9nZ2xlUmVuZGVyTGF0ZXgoKVxuICAgICAgfSxcbiAgICB9KSxcbiAgICBhdG9tLndvcmtzcGFjZS5hZGRPcGVuZXIob3BlbmVyKSxcbiAgICBhdG9tLmNvbmZpZy5vYnNlcnZlKFxuICAgICAgJ21hcmtkb3duLXByZXZpZXctcGx1cy5ncmFtbWFycycsXG4gICAgICBjb25maWdPYnNlcnZlcihyZWdpc3RlckdyYW1tYXJzKSxcbiAgICApLFxuICAgIGF0b20uY29uZmlnLm9ic2VydmUoXG4gICAgICAnbWFya2Rvd24tcHJldmlldy1wbHVzLmV4dGVuc2lvbnMnLFxuICAgICAgY29uZmlnT2JzZXJ2ZXIocmVnaXN0ZXJFeHRlbnNpb25zKSxcbiAgICApLFxuICApXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZWFjdGl2YXRlKCkge1xuICBkaXNwb3NhYmxlcyAmJiBkaXNwb3NhYmxlcy5kaXNwb3NlKClcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1hcmtkb3duUHJldmlld1ZpZXcoc3RhdGU6IFNlcmlhbGl6ZWRNUFYpIHtcbiAgaWYgKHN0YXRlLmVkaXRvcklkICE9PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm4gbmV3IFBsYWNlaG9sZGVyVmlldyhzdGF0ZS5lZGl0b3JJZClcbiAgfSBlbHNlIGlmIChzdGF0ZS5maWxlUGF0aCAmJiB1dGlsLmlzRmlsZVN5bmMoc3RhdGUuZmlsZVBhdGgpKSB7XG4gICAgcmV0dXJuIG5ldyBNYXJrZG93blByZXZpZXdWaWV3RmlsZShzdGF0ZS5maWxlUGF0aClcbiAgfVxuICByZXR1cm4gdW5kZWZpbmVkXG59XG5cbi8vLyBwcml2YXRlXG5cbmFzeW5jIGZ1bmN0aW9uIGNsb3NlKGV2ZW50OiBDb21tYW5kRXZlbnQ8SFRNTEVsZW1lbnQ+KTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IGl0ZW0gPSBNYXJrZG93blByZXZpZXdWaWV3LnZpZXdGb3JFbGVtZW50KGV2ZW50LmN1cnJlbnRUYXJnZXQpXG4gIGlmICghaXRlbSkgcmV0dXJuXG4gIGNvbnN0IHBhbmUgPSBhdG9tLndvcmtzcGFjZS5wYW5lRm9ySXRlbShpdGVtKVxuICBpZiAoIXBhbmUpIHJldHVyblxuICBhd2FpdCBwYW5lLmRlc3Ryb3lJdGVtKGl0ZW0pXG59XG5cbmFzeW5jIGZ1bmN0aW9uIHRvZ2dsZShlZGl0b3I6IFRleHRFZGl0b3IpIHtcbiAgaWYgKHJlbW92ZVByZXZpZXdGb3JFZGl0b3IoZWRpdG9yKSkgcmV0dXJuIHVuZGVmaW5lZFxuICBlbHNlIHJldHVybiBhZGRQcmV2aWV3Rm9yRWRpdG9yKGVkaXRvcilcbn1cblxuZnVuY3Rpb24gcmVtb3ZlUHJldmlld0ZvckVkaXRvcihlZGl0b3I6IFRleHRFZGl0b3IpIHtcbiAgY29uc3QgaXRlbSA9IE1hcmtkb3duUHJldmlld1ZpZXdFZGl0b3Iudmlld0ZvckVkaXRvcihlZGl0b3IpXG4gIGlmICghaXRlbSkgcmV0dXJuIGZhbHNlXG4gIGNvbnN0IHByZXZpZXdQYW5lID0gYXRvbS53b3Jrc3BhY2UucGFuZUZvckl0ZW0oaXRlbSlcbiAgaWYgKCFwcmV2aWV3UGFuZSkgcmV0dXJuIGZhbHNlXG4gIGlmIChpdGVtICE9PSBwcmV2aWV3UGFuZS5nZXRBY3RpdmVJdGVtKCkpIHtcbiAgICBwcmV2aWV3UGFuZS5hY3RpdmF0ZUl0ZW0oaXRlbSlcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxuICB1dGlsLmhhbmRsZVByb21pc2UocHJldmlld1BhbmUuZGVzdHJveUl0ZW0oaXRlbSkpXG4gIHJldHVybiB0cnVlXG59XG5cbmFzeW5jIGZ1bmN0aW9uIGFkZFByZXZpZXdGb3JFZGl0b3IoZWRpdG9yOiBUZXh0RWRpdG9yKSB7XG4gIGNvbnN0IHByZXZpb3VzQWN0aXZlUGFuZSA9IGF0b20ud29ya3NwYWNlLmdldEFjdGl2ZVBhbmUoKVxuICBjb25zdCBvcHRpb25zOiBXb3Jrc3BhY2VPcGVuT3B0aW9ucyA9IHsgc2VhcmNoQWxsUGFuZXM6IHRydWUgfVxuICBjb25zdCBzcGxpdENvbmZpZyA9IHV0aWwuYXRvbUNvbmZpZygpLnByZXZpZXdDb25maWcucHJldmlld1NwbGl0UGFuZURpclxuICBpZiAoc3BsaXRDb25maWcgIT09ICdub25lJykge1xuICAgIG9wdGlvbnMuc3BsaXQgPSBzcGxpdENvbmZpZ1xuICB9XG4gIGNvbnN0IHJlcyA9IGF3YWl0IGF0b20ud29ya3NwYWNlLm9wZW4oXG4gICAgTWFya2Rvd25QcmV2aWV3Vmlld0VkaXRvci5jcmVhdGUoZWRpdG9yKSxcbiAgICBvcHRpb25zLFxuICApXG4gIHByZXZpb3VzQWN0aXZlUGFuZS5hY3RpdmF0ZSgpXG4gIHJldHVybiByZXNcbn1cblxuYXN5bmMgZnVuY3Rpb24gcHJldmlld0ZpbGUoeyBjdXJyZW50VGFyZ2V0IH06IENvbW1hbmRFdmVudCk6IFByb21pc2U8dm9pZD4ge1xuICBjb25zdCBmaWxlUGF0aCA9IChjdXJyZW50VGFyZ2V0IGFzIEhUTUxFbGVtZW50KS5kYXRhc2V0LnBhdGhcbiAgaWYgKCFmaWxlUGF0aCkge1xuICAgIHJldHVyblxuICB9XG5cbiAgZm9yIChjb25zdCBlZGl0b3Igb2YgYXRvbS53b3Jrc3BhY2UuZ2V0VGV4dEVkaXRvcnMoKSkge1xuICAgIGlmIChlZGl0b3IuZ2V0UGF0aCgpID09PSBmaWxlUGF0aCkge1xuICAgICAgYXdhaXQgYWRkUHJldmlld0ZvckVkaXRvcihlZGl0b3IpXG4gICAgICByZXR1cm5cbiAgICB9XG4gIH1cblxuICBhd2FpdCBhdG9tLndvcmtzcGFjZS5vcGVuKFxuICAgIGBtYXJrZG93bi1wcmV2aWV3LXBsdXM6Ly9maWxlLyR7ZW5jb2RlVVJJKGZpbGVQYXRoKX1gLFxuICAgIHtcbiAgICAgIHNlYXJjaEFsbFBhbmVzOiB0cnVlLFxuICAgIH0sXG4gIClcbn1cblxuYXN5bmMgZnVuY3Rpb24gY29weUh0bWxJbnRlcm5hbChlZGl0b3I6IFRleHRFZGl0b3IpOiBQcm9taXNlPHZvaWQ+IHtcbiAgY29uc3QgcmVuZGVyTGFUZVggPSB1dGlsLmF0b21Db25maWcoKS5tYXRoQ29uZmlnLmVuYWJsZUxhdGV4UmVuZGVyaW5nQnlEZWZhdWx0XG4gIGNvbnN0IHRleHQgPSBlZGl0b3IuZ2V0U2VsZWN0ZWRUZXh0KCkgfHwgZWRpdG9yLmdldFRleHQoKVxuICBhd2FpdCB1dGlsLmNvcHlIdG1sKHRleHQsIGVkaXRvci5nZXRQYXRoKCksIHJlbmRlckxhVGVYKVxufVxuXG50eXBlIENvbnRleHRNZW51ID0geyBba2V5OiBzdHJpbmddOiBDb250ZXh0TWVudU9wdGlvbnNbXSB9XG5cbmZ1bmN0aW9uIGNvbmZpZ09ic2VydmVyPFQ+KFxuICBmOiAoXG4gICAgdmFsdWU6IFQsXG4gICAgZGlzcG9zYWJsZXM6IENvbXBvc2l0ZURpc3Bvc2FibGUsXG4gICAgY29udGV4dE1lbnU6IENvbnRleHRNZW51LFxuICApID0+IHZvaWQsXG4pIHtcbiAgbGV0IGNvbmZpZ0Rpc3Bvc2FibGVzOiBDb21wb3NpdGVEaXNwb3NhYmxlXG4gIHJldHVybiBmdW5jdGlvbih2YWx1ZTogVCkge1xuICAgIGlmICghZGlzcG9zYWJsZXMpIHJldHVyblxuICAgIGlmIChjb25maWdEaXNwb3NhYmxlcykge1xuICAgICAgY29uZmlnRGlzcG9zYWJsZXMuZGlzcG9zZSgpXG4gICAgICBkaXNwb3NhYmxlcy5yZW1vdmUoY29uZmlnRGlzcG9zYWJsZXMpXG4gICAgfVxuICAgIGNvbmZpZ0Rpc3Bvc2FibGVzID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKVxuICAgIGNvbnN0IGNvbnRleHRNZW51OiBDb250ZXh0TWVudSA9IHt9XG4gICAgZih2YWx1ZSwgY29uZmlnRGlzcG9zYWJsZXMsIGNvbnRleHRNZW51KVxuICAgIGNvbmZpZ0Rpc3Bvc2FibGVzLmFkZChhdG9tLmNvbnRleHRNZW51LmFkZChjb250ZXh0TWVudSkpXG4gICAgZGlzcG9zYWJsZXMuYWRkKGNvbmZpZ0Rpc3Bvc2FibGVzKVxuICB9XG59XG5cbmZ1bmN0aW9uIHJlZ2lzdGVyRXh0ZW5zaW9ucyhcbiAgZXh0ZW5zaW9uczogc3RyaW5nW10sXG4gIGRpc3A6IENvbXBvc2l0ZURpc3Bvc2FibGUsXG4gIGNtOiBDb250ZXh0TWVudSxcbikge1xuICBmb3IgKGNvbnN0IGV4dCBvZiBleHRlbnNpb25zKSB7XG4gICAgY29uc3Qgc2VsZWN0b3IgPSBgLnRyZWUtdmlldyAuZmlsZSAubmFtZVtkYXRhLW5hbWUkPVwiLiR7ZXh0fVwiXWBcbiAgICBkaXNwLmFkZChcbiAgICAgIGF0b20uY29tbWFuZHMuYWRkKFxuICAgICAgICBzZWxlY3RvcixcbiAgICAgICAgJ21hcmtkb3duLXByZXZpZXctcGx1czpwcmV2aWV3LWZpbGUnLFxuICAgICAgICBwcmV2aWV3RmlsZSxcbiAgICAgICksXG4gICAgKVxuICAgIGNtW3NlbGVjdG9yXSA9IFtcbiAgICAgIHtcbiAgICAgICAgbGFiZWw6ICdNYXJrZG93biBQcmV2aWV3JyxcbiAgICAgICAgY29tbWFuZDogJ21hcmtkb3duLXByZXZpZXctcGx1czpwcmV2aWV3LWZpbGUnLFxuICAgICAgfSxcbiAgICBdXG4gIH1cbn1cblxuZnVuY3Rpb24gcmVnaXN0ZXJHcmFtbWFycyhcbiAgZ3JhbW1hcnM6IHN0cmluZ1tdLFxuICBkaXNwOiBDb21wb3NpdGVEaXNwb3NhYmxlLFxuICBjbTogQ29udGV4dE1lbnUsXG4pIHtcbiAgZm9yIChjb25zdCBnciBvZiBncmFtbWFycykge1xuICAgIGNvbnN0IGdycyA9IGdyLnJlcGxhY2UoL1xcLi9nLCAnICcpXG4gICAgY29uc3Qgc2VsZWN0b3IgPSBgYXRvbS10ZXh0LWVkaXRvcltkYXRhLWdyYW1tYXI9XCIke2dyc31cIl1gXG4gICAgZGlzcC5hZGQoXG4gICAgICBhdG9tLmNvbW1hbmRzLmFkZChzZWxlY3RvciBhcyAnYXRvbS10ZXh0LWVkaXRvcicsIHtcbiAgICAgICAgJ21hcmtkb3duLXByZXZpZXctcGx1czp0b2dnbGUnOiAoZSkgPT4ge1xuICAgICAgICAgIHV0aWwuaGFuZGxlUHJvbWlzZSh0b2dnbGUoZS5jdXJyZW50VGFyZ2V0LmdldE1vZGVsKCkpKVxuICAgICAgICB9LFxuICAgICAgICAnbWFya2Rvd24tcHJldmlldy1wbHVzOmNvcHktaHRtbCc6IChlKSA9PiB7XG4gICAgICAgICAgdXRpbC5oYW5kbGVQcm9taXNlKGNvcHlIdG1sSW50ZXJuYWwoZS5jdXJyZW50VGFyZ2V0LmdldE1vZGVsKCkpKVxuICAgICAgICB9LFxuICAgICAgfSksXG4gICAgKVxuICAgIGNtW3NlbGVjdG9yXSA9IFtcbiAgICAgIHtcbiAgICAgICAgbGFiZWw6ICdTeW5jIFByZXZpZXcnLFxuICAgICAgICBjb21tYW5kOiAnbWFya2Rvd24tcHJldmlldy1wbHVzOnN5bmMtcHJldmlldycsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBsYWJlbDogJ0NvcHkgTWFya2Rvd24gYXMgSFRNTCcsXG4gICAgICAgIGNvbW1hbmQ6ICdtYXJrZG93bi1wcmV2aWV3LXBsdXM6Y29weS1odG1sJyxcbiAgICAgIH0sXG4gICAgXVxuICB9XG59XG5cbmZ1bmN0aW9uIG9wZW5lcih1cmlUb09wZW46IHN0cmluZykge1xuICB0cnkge1xuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby12YXIta2V5d29yZCBwcmVmZXItY29uc3RcbiAgICB2YXIgdXJpID0gdXJsLnBhcnNlKHVyaVRvT3BlbilcbiAgfSBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUuZXJyb3IoZSwgdXJpVG9PcGVuKVxuICAgIHJldHVybiB1bmRlZmluZWRcbiAgfVxuXG4gIGlmICh1cmkucHJvdG9jb2wgIT09ICdtYXJrZG93bi1wcmV2aWV3LXBsdXM6JykgcmV0dXJuIHVuZGVmaW5lZFxuICBpZiAoIXVyaS5wYXRobmFtZSkgcmV0dXJuIHVuZGVmaW5lZFxuXG4gIHRyeSB7XG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLXZhci1rZXl3b3JkIHByZWZlci1jb25zdFxuICAgIHZhciBwYXRobmFtZSA9IGRlY29kZVVSSSh1cmkucGF0aG5hbWUpXG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmVycm9yKGUpXG4gICAgcmV0dXJuIHVuZGVmaW5lZFxuICB9XG5cbiAgaWYgKHVyaS5ob3N0bmFtZSA9PT0gJ2ZpbGUnKSB7XG4gICAgcmV0dXJuIG5ldyBNYXJrZG93blByZXZpZXdWaWV3RmlsZShwYXRobmFtZS5zbGljZSgxKSlcbiAgfSBlbHNlIGlmICh1cmkuaG9zdG5hbWUgPT09ICdlZGl0b3InKSB7XG4gICAgY29uc3QgZWRpdG9ySWQgPSBwYXJzZUludChwYXRobmFtZS5zbGljZSgxKSwgMTApXG4gICAgY29uc3QgZWRpdG9yID0gYXRvbS53b3Jrc3BhY2VcbiAgICAgIC5nZXRUZXh0RWRpdG9ycygpXG4gICAgICAuZmluZCgoZWQpID0+IGVkLmlkID09PSBlZGl0b3JJZClcbiAgICBpZiAoZWRpdG9yID09PSB1bmRlZmluZWQpIHtcbiAgICAgIGF0b20ubm90aWZpY2F0aW9ucy5hZGRXYXJuaW5nKFxuICAgICAgICAnTWFya2Rvd24tcHJldmlldy1wbHVzOiBUcmllZCB0byBvcGVuIHByZXZpZXcgJyArXG4gICAgICAgICAgYGZvciBlZGl0b3Igd2l0aCBpZCAke2VkaXRvcklkfSwgd2hpY2ggZG9lcyBub3QgZXhpc3RgLFxuICAgICAgKVxuICAgICAgcmV0dXJuIHVuZGVmaW5lZFxuICAgIH1cbiAgICByZXR1cm4gTWFya2Rvd25QcmV2aWV3Vmlld0VkaXRvci5jcmVhdGUoZWRpdG9yKVxuICB9IGVsc2UgaWYgKHVyaS5ob3N0bmFtZSA9PT0gJ3JlbW90ZS1lZGl0b3InKSB7XG4gICAgY29uc3QgW3dpbmRvd0lkLCBlZGl0b3JJZF0gPSBwYXRobmFtZVxuICAgICAgLnNsaWNlKDEpXG4gICAgICAuc3BsaXQoJy8nKVxuICAgICAgLm1hcCgoeCkgPT4gcGFyc2VJbnQoeCwgMTApKVxuICAgIHJldHVybiBuZXcgTWFya2Rvd25QcmV2aWV3Vmlld0VkaXRvclJlbW90ZSh3aW5kb3dJZCwgZWRpdG9ySWQpXG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgYFRyaWVkIHRvIG9wZW4gbWFya2Rvd24tcHJldmlldy1wbHVzIHdpdGggdXJpICR7dXJpVG9PcGVufS4gVGhpcyBpcyBub3Qgc3VwcG9ydGVkLiBQbGVhc2UgcmVwb3J0IHRoaXMgZXJyb3IuYCxcbiAgICApXG4gIH1cbn1cbiJdfQ==
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/10/31/markdown-preview-plus/lib/main/" data-id="ck2kdakqo000mgsum8qa9gjof" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/5/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/7/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/"></a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/" rel="tag"></a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/" style="font-size: 10px;"></a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/11/01/HomePage-test/">HomePage_test</a>
          </li>
        
          <li>
            <a href="/2019/10/31/markdown-preview-plus/src/tsconfig/">markdown-preview-plus/src/tsconfig</a>
          </li>
        
          <li>
            <a href="/2019/10/31/markdown-preview-plus/src/tslint/">markdown-preview-plus/src/tslint</a>
          </li>
        
          <li>
            <a href="/2019/10/31/markdown-preview-plus/src-client/template/">markdown-preview-plus/src-client/template</a>
          </li>
        
          <li>
            <a href="/2019/10/31/markdown-preview-plus/src-client/tsconfig/">markdown-preview-plus/src-client/tsconfig</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 ElainaChan<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>